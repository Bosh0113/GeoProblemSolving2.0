<!DOCTYPE html>
<html lang="en">
<head >
    <title>Demo</title>
    <meta http-equiv="Content-Type" content=" charset=UTF-8" />
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
    <link href="https://cdn.bootcss.com/iview/3.4.2/styles/iview.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/iview/3.4.2/iview.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-avatar@2.1.7/dist/vue-avatar.min.js"></script>
    <script src="https://cdn.bootcss.com/axios/0.19.0-beta.1/axios.min.js"></script>


    <style scoped>
        #logo {
            position: absolute;
            width: 129px;
            height: 40px;
            z-index: 1;
            margin-top: 5px;
            margin-left: 2.5%;
            cursor: pointer;
        }

        .header span {
            font-size: 15px;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        header {
            height: 60px;
            top: 0;
            z-index: 100;
            position: absolute;
            width: 100%;
            flex: 0 0 auto;
            position: absolute;
            min-width: 1200px;
        }

        .content {
            flex: 1 0 auto;
            margin-top: 60px;
        }

        footer {
            background-color: #515a6e;
            height: 60px;
            width: 100%;
            bottom: 0;
            flex: 0 0 auto;
        }

        .userState {
            position: absolute;
            width: 15%;
            top: 0px;
            z-index: 1;
            display: inline-block;
            min-width: fit-content;
        }

        .navPart {
            width: 85%;
            display: inline-block;
        }

        .menuItem a {
            font-size: 1.2em;
            font-weight: bold;
            color: rgba(255, 255, 255, 1);
        }

        .userImg {
            width: 40px;
            height: 40px;
            vertical-align: middle;
        }

        .footerTop {
            text-align: center;
            color: white;
            font-weight: bold;
            margin-top: 10px;
        }

        .footerBottom {
            text-align: center;
            color: white;
            font-size: 0.8em;
        }
    </style>
    <template id="navigation">
        <div style="position: fixed;z-index: 999;">
            <header style="position:inherit;min-width: -webkit-fill-available;">
                <img :src='window.location.origin+"/GeoProblemSolving/Images/OGMS.png"' id="logo" class="pic"
                     @click="goHome" style="cursor:pointer;margin-left:5%">
                <div v-if="useMenuCSS">
                    <div class="navPart">
                        <i-menu mode="horizontal" theme="dark" @on-select="turnContent"
                                :style="`z-index:0;background:headerBgColor`" width="auto" active-name="projects">
                            <menu-item name="home" class="menuItem" style="margin-left:35%">
                                <span>Home</span>
                            </menu-item>
                            <menu-item name="projects" class="menuItem">
                                <span>Projects</span>
                            </menu-item>
                            <menu-item name="resources" class="menuItem">
                                <span>Resources</span>
                            </menu-item>
                            <menu-item name="help" class="menuItem">
                                <span>Help</span>
                            </menu-item>
                        </i-menu>
                    </div>
                    <div class="userState">
                        <i-menu mode="horizontal" theme="dark" @on-select="unlogin"
                                :style="`z-index:0;background:`+headerBgColor"
                                v-show="!userInfoNav.userState||userInfoNav.userState==undefined"
                                class="menuItem">
                            <menu-item name="login">
                                <span>Login</span>
                            </menu-item>
                            <menu-item name="register">
                                <span>Sign up</span>
                            </menu-item>
                        </i-menu>

                        <i-menu mode="horizontal" theme="dark" @on-select="logged"
                                :style="`z-index:0;background:`+headerBgColor" v-show="userInfoNav.userState"
                                class="menuItem">
                            <menu-item name="notification">
                                <Badge :count="unreadNoticeCount" id="noticeBadge">
                                    <Icon type="ios-notifications-outline" size="25"></Icon>
                                </Badge>
                            </menu-item>
                            <menu-item name="personal" style="width:100px">
                                <dropdown @on-click="changeSelect" placement="bottom-start">
                                    <div @click="toPersonalPage">
                                        <img v-if="userInfoNav.avatar!=''&&userInfoNav.avatar!=undefined&&userInfoNav.avatar!=null"
                                             :title="userInfoNav.userName"
                                             style="width:40px;height:40px;vertical-align:middle;">
                                        <avatar :username="userInfoNav.userName" :size="40" style="margin-top:10px"
                                                :title="userInfoNav.userName" v-else></avatar>
                                    </div>
                                    <dropdown-menu slot="list">
                                        <dropdown-item name="logout">Log out</dropdown-item>
                                    </dropdown-menu>
                                </dropdown>
                            </menu-item>
                        </i-menu>
                    </div>
                </div>
                <div v-else>
                    <i-menu mode="horizontal" theme="dark" style="z-index: 0;"></i-menu>
                    <Dropdown style="position: fixed;top: 10px;right: 20px;">
                        <i-button icon="md-menu" style="color: white;background-color: #808695"></i-button>
                        <Dropdown-menu slot="list">
                            <Dropdown-item>
                                <a href="/GeoProblemSolving/home.html">Home</a>
                            </Dropdown-item>
                            <Dropdown-item>
                                <a href="/GeoProblemSolving/projectList.html">Projects</a>
                            </Dropdown-item>
                            <Dropdown-item>
                                <a href="/GeoProblemSolving/resources.html">Resources</a>
                            </Dropdown-item>
                            <Dropdown-item>
                                <a href="/GeoProblemSolving/help.html">Help</a>
                            </Dropdown-item>
                            <Dropdown-item v-show="!userInfoNav.userState||userInfoNav.userState==undefined">
                                <a href="/GeoProblemSolving/login.html">Login</a>
                            </Dropdown-item>
                            <Dropdown-item v-show="!userInfoNav.userState||userInfoNav.userState==undefined">
                                <a href="/GeoProblemSolving/register.html">Sign up</a>
                            </Dropdown-item>
                            <Dropdown-item v-show="userInfoNav.userState">
                                <a href="/GeoProblemSolving/notifications.html">Notification</a>
                            </Dropdown-item>
                            <Dropdown-item v-show="userInfoNav.userState">
                                <a @click.native="toPersonalPage">Personal Page</a>
                            </Dropdown-item>
                            <Dropdown-item v-show="userInfoNav.userState">
                                <a @click.native="logout">Log out</a>
                            </Dropdown-item>
                        </Dropdown-menu>
                    </Dropdown>
                </div>
            </header>
        </div>
    </template>
    <script>
        Vue.component('child-navigation', {
                template: '#navigation',
                components: {
                    'avatar': VueAvatar.Avatar
                },
                mounted() {
                    var that = this;
                    $.ajax({
                        url: "/GeoProblemSolving/user/state",
                        type: "GET",
                        async: false,
                        success: function (data) {
                            if (data) {
                                data.userState = true;
                                that.userInfoNav = data;
                                sessionStorage.setItem('userInfo', JSON.stringify(data));
                                that.setTimer();
                                that.initWebSocket();
                                that.getUnreadNoticeCount();
                            } else {
                                console.log("Not logged in");
                            }
                        },
                        error: function (err) {
                            console.log("Get user info fail.");
                        }
                    });
                },
                computed: {
                    headerBgColor() {
                        return "";
                    }
                },
                data() {
                    return {
                        //消息机制
                        noticeSocket: null,
                        unreadNoticeCount: 0,
                        timer: null,
                        //导航栏宽度
                        headerWidth: "",
                        //用户
                        userInfoNav: {
                            userName: ""
                        },
                        useMenuCSS: true
                    }
                },
                methods: {
                    identityMenuCSS(){
                        if(window.innerWidth<1100){
                            this.useMenuCSS = false;
                        }
                        else{
                            this.useMenuCSS = true;
                        }
                    },
                    turnContent(name) {
                        if (name === "home") {
                            window.location.href = "/GeoProblemSolving/home.html"
                        } else if (name == "projects") {
                            window.location.href = "/GeoProblemSolving/projectList.html"
                        } else if (name == "resources") {
                            window.location.href = "/GeoProblemSolving/resources.html"
                        } else if (name == "community") {
                            window.location.href = "/GeoProblemSolving/community.html"
                        } else if (name == "help") {
                            window.location.href = "/GeoProblemSolving/help.html"
                        }
                    },
                    goHome() {
                        window.location.href = "/GeoProblemSolving/home.html"
                    },
                    unlogin(name) {
                        if (name === "login") {
                            window.location.href = "/GeoProblemSolving/login.html"
                        } else if (name == "register") {
                            window.location.href = "/GeoProblemSolving/register.html"
                        }
                    },
                    logged(name) {
                        if (name === "notification") {
                            window.location.href = "/GeoProblemSolving/notifications.html"
                        } else if (name === "personal") {
                        }
                    },
                    toPersonalPage() {
                        window.location.href = "/GeoProblemSolving//personal/" + this.userInfoNav.userId + ".html"
                    },
                    // 获取到通知的数量
                    getUnreadNoticeCount() {
                        this.unreadNoticeCount = 0;
                        //get请求发送的是用户id
                        axios
                            .get(
                                "/GeoProblemSolving/notice/inquiry" +
                                "?key=recipientId" +
                                "&value=" +
                                this.userInfoNav.userId
                            )
                            .then(res => {
                                let noticeList = res.data;
                                let unreadCount = 0;
                                for (let i = 0; i < noticeList.length; i++) {
                                    if (noticeList[i].state === "unread") {
                                        unreadCount++;
                                        continue;
                                    }
                                }
                                this.$set(this, "unreadNoticeCount", unreadCount);
                            })
                            .catch(err => {
                                console.log("失败的原因是" + err.data);
                            });
                    },
                    initWebSocket() {
                        if (this.noticeSocket != null) {
                            this.noticeSocket = null;
                        }
                        var noticeSocketURL = "ws://" + window.location.host + "/GeoProblemSolving/NoticeSocket";
                        this.noticeSocket = new WebSocket(noticeSocketURL);
                        this.noticeSocket.onopen = this.onOpen;
                        this.noticeSocket.onmessage = this.onMessage;
                        this.noticeSocket.onclose = this.onClose;
                        this.noticeSocket.onerror = this.onError;
                    },
                    onOpen() {
                        // console.log("NoticeSocket连接成功！");
                    },
                    onMessage(e) {
                        if (e.data == "Notice") {
                            let newCount = this.unreadNoticeCount + 1;
                            this.$set(this, "unreadNoticeCount", newCount);
                            this.$Message.info("You have a new notice!");
                        } else {
                            console.log(e.data);
                        }
                    },
                    onClose(e) {
                        this.removeTimer();
                        // console.log("NoticeSocket连接断开！");
                    },
                    onError(e) {
                        this.removeTimer();
                        // console.log("NoticeSocket连接错误！");
                    },
                    sendMessage(recipientId) {
                        this.noticeSocket.send(recipientId);
                    },
                    setTimer() {
                        var that = this;
                        this.timer = setInterval(() => {
                            if (that.noticeSocket != null && that.noticeSocket != undefined) {
                                that.noticeSocket.send("ping");
                            }
                        }, 20000);
                    },
                    removeTimer() {
                        clearInterval(this.timer);
                    },
                    readNotification() {
                        let newCount = this.unreadNoticeCount;
                        if (newCount > 0) {
                            this.unreadNoticeCount = newCount - 1;
                        }
                    },
                    changeSelect(name) {
                        if (name == "logout") {
                            this.logout("home");
                        }
                    },
                    logout(page){
                        axios
                            .get("/GeoProblemSolving/user/logout")
                            .then(res => {
                                this.userInfoNav = {userName: ""};
                                sessionStorage.removeItem("userInfo");
                                this.noticeSocket.close();
                                window.location.href = "/GeoProblemSolving/"+page+".html";
                            })
                            .catch(err => {
                                confirm("logout fail!");
                            });
                    }
                }
            },
        )
    </script>

    <template id="tabContent">
        <div>
            <div v-if="projectList.length > 0">
                <div class="projectCard" v-for="(item,index) in projectList" :key="item.index"  style="width:95%;margin-right:5%"  >
                    <i-col :xs="{ span: 21, offset: 1 }"
                           :md="{ span:5, offset: 1 }"
                           :lg="{ span: 3, offset: 1}">
                        <div @click="projectInfoModalShow(item)" style="cursor:pointer">
                            <Card style="height:auto;margin:15px -15px">
                                <!-- title-->
                                <span slot="title" class="projectTitle" :title="item.title">{{item.title}}</span>

                                <!-- 右上角的button-->
                                <div class="operate" slot="extra" style="display:flex;align-items:center">
                                    <Icon type="md-eye" :size="20" title="Public project"  v-show="!(item.isManager||item.isMember) && (item.privacy=='Public')" ></Icon>
                                    <Icon type="md-lock" :size="20" title="Discoverable project"  v-show="!(item.isManager||item.isMember) && (item.privacy=='Discoverable')" ></Icon>
                                    <br/>
                                    <Icon type="md-person" :size="20" title="Managed or joined project" v-show="item.isMember||item.isManager" :id="item.projectId" ></Icon>
                                </div>
                                <!--  description-->
                                <div style="display:flex;align-items:center;height:20px">
                                    <strong style="text-align: center">Description</strong>
                                    <p style="padding: 0 10px;word-break:break-word;overflow: hidden; white-space: nowrap; text-overflow: ellipsis; max-width: 400px;" :title="item.description" >
                                        {{item.description}}
                                    </p>
                                </div>
                                <!--  avatar-->
                                <div style="height:200px;display:flex;justify-content:center;margin-top:10px">
                                    <img :src="item.picture" v-if="item.picture!=''&&item.picture!='undefined'" />
                                    <avatar :username="item.title" :size="200"  :title="item.title" :rounded="false"  v-else >  </avatar>
                                </div>
                                <!--managername -->
                                <div  class="cardicon"  >
                                    <Icon type="md-body" :size="15" Manager></Icon>
                                    <span style="height:20px;margin-left:5%">
                                <strong>{{item.managerName}}</strong>
                            </span>
                                </div>
                                <!--time-->
                                <div class="cardicon" >
                                    <Icon type="md-clock" :size="15" Time></Icon>
                                    <span style="height:20px;margin-left:5%">
                                <strong>{{item.createTime.split(' ')[0]}}</strong>
                            </span>
                                </div>
                                <!--tag -->
                                <div class="cardicon" >
                                    <Icon type="md-pricetags" :size="15" Tags></Icon>
                                    <strong style=" margin-left:5%; display: inline-block; overflow: hidden;  white-space: nowrap; text-overflow: ellipsis;" >
                                        {{item.tag}}
                                    </strong>
                                </div>
                            </Card>
                        </div>
                    </i-col>
                </div>
            </div>
            <div v-else>
                <i-col span="22" offset="1">
                    <Card :bordered="false" style="min-height: 500px; margin-top: 3%">
                        <div style="display:flex;justify-content:center">
                            <Icon type="md-alert" size="40" color="gray" ></Icon>
                        </div>
                        <br />
                        <div style="display:flex;justify-content:center;">
                            <h2 style="text-align:center;width:50%">No more projects in this category.</h2>
                        </div>
                        <br />
                        <div style="display:flex;justify-content:center">
                            <h4 style="text-align:center;width:50%;color:lightblue">
                                You can click the button right top to add a new project.
                                <br />Enriching your description of the project and attracting more people to join in.
                            </h4>
                        </div>
                    </Card>
                </i-col>
            </div>

            <Modal v-model="projectInfoModal" title="Project information"  width="800px" class="projectInfoModal">
                <i-table stripe border :columns="columns" :data="projectInfoShow" :show-header="false"  ></i-table>
                <div slot="footer">
                    <Alert  show-icon  style="float: left;width: fit-content;display: inline-block;"  v-show="!UserState">
                        If you want to participate in the project, please login.
                    </Alert>
                    <i-button v-show="!UserState" type="success" @click="login">Log in</i-button>
                    <i-button
                            v-show="!selectedProjectInfo.isMember&&!selectedProjectInfo.isManager && UserState && selectedProjectInfo.privacy=='Public'"
                            type="success"
                            title="Enter project directly"
                            @click="enterProject(selectedProjectInfo)"
                    >Enter</i-button>
                    <i-button
                            type="success"
                            @click="joinApplyModalShow(selectedProjectInfo)"
                            v-show="!selectedProjectInfo.isMember&&!selectedProjectInfo.isManager&&UserState"
                            title="Apply to join the project"
                    >Apply</i-button>
                </div>
            </Modal>

            <Modal v-model="applyJoinModal" title="Apply to join the project">
                <i-form ref="applyValidate" :model="applyValidate" :rules="applyRuleValidate" :label-width="80">
                    <form-item label="Reason" prop="reason">
                        <i-input
                                v-model="applyValidate.reason"
                                type="textarea"
                                :rows="4"
                                placeholder="Enter The Reason For Application ..."
                        ></i-input>
                    </form-item>
                </i-form>
                <div slot="footer">
                    <i-button @click="applyJoinModal=false">Cancel</i-button>
                    <i-button type="success" @click="joinApply('applyValidate')">Apply</i-button>
                </div>
            </Modal>
        </div>
    </template>
    <style scoped>
        img {
            width: 100%;
            height: auto;
        }
        .projectTitle {
            height: 16px;
            line-height: 15px;
            font-size: 16px;
            max-width: 150px;
            padding-left: 5px;
            display: inline-block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .cardicon{
            height:15px;
            align-items:center;
            display:flex;
            justify-content:flex-start;
            margin-top:10px
        }
        /*Modal*/

        .ivu-modal-header{
            padding: 15px 20px  0px 20px;
            border-bottom: 0px solid #e9eaec; //下划线
        }
        .ivu-modal-header-inner{
            font-size: 16px;
        }
        /*.ivu-modal-body{*/
        /*    width: auto;*/
        /*}*/
        /*.ivu-table-wrapper{*/
        /*    width: 100%;*/
        /*}*/
        /*.ivu-table-body table{*/
        /*    width: 80%;*/
        /*}*/

        .btnCreate:hover,
        .joinProjectBtn:hover {
            background-color: #19be6b;
            color: white;
        }
    </style>
    <script>

        Vue.component('tab-content',{
            template:'#tabContent',
            props: ["projectList"],
            components:{
                'avatar':VueAvatar.Avatar
            },
            data(){
                return{
                    selectedProjectInfo: {},
                    projectInfoModal: false,//modal模态框
                    columns: [
                        { title: "Key", key: "key", width: "150px" },
                        { title: "Value", key: "value" , width: "618px"}
                    ],
                    projectInfoShow: [],
                    //加入项目
                    applyProjectInfo: {},
                    applyValidate: {
                        reason: ""
                    },
                    applyRuleValidate: {
                        reason: [
                            { required: true, message: "Please enter the reason for application", trigger: "blur" },
                            { type: "string", min: 5, message: "The reason no less than 10 characters", trigger: "blur" }
                        ]
                    },
                    applyJoinModal: false,
                    // 记录已经申请的情况
                    haveApplied: false,
                    // 申请加入项目的模态框
                    applyJoinModal: false,
                    // // 申请加入公共项目的模态框
                    // publicApplyAssureModal: false

                }
            },

            methods:{
                projectInfoModalShow(projectInfo) {
                    if (projectInfo.isMember || projectInfo.isManager) {
                        // this.$router.push({ path: `project/${projectInfo.projectId}` });
                        window.location.href="/GeoProblemSolving/Projects/${projectInfo.projectId}"
                    } else {
                        this.selectedProjectInfo = Object.assign({}, projectInfo);
                        var category = "";
                        if (projectInfo.category != "Human" &&  projectInfo.category != "GISRS"){category = projectInfo.category;}
                        else if (projectInfo.category == "Human"){category = "Human-Activity";}
                        else if (projectInfo.category == "GISRS"){category = "GIS & RS";}

                        var membersName = "";
                        var members = projectInfo.members;
                        for (var i = 0; i < members.length; i++) {
                            if (i == 0) {
                                membersName = members[i].userName;
                            } else {
                                membersName = membersName + "," + members[i].userName;
                            }
                        }
                        this.projectInfoShow = [
                            {
                                key: "Category",
                                value: category
                            },
                            {
                                key: "Title",
                                value: projectInfo.title
                            },
                            {
                                key: "Description",
                                value: projectInfo.description
                            },
                            {
                                key: "Introduction",
                                value: projectInfo.introduction
                            },
                            {
                                key: "Tag",
                                value: projectInfo.tag
                            },
                            {
                                key: "Manager",
                                value: projectInfo.managerName
                            },
                            {
                                key: "Members",
                                value: membersName
                            },
                            {
                                key: "Created Time",
                                value: projectInfo.createTime
                            }
                        ];

                        this.projectInfoModal = true;
                    }
                },

                login() {
                    window.location.href="/GeoProblemSolving/Login"
                },

                enterProject(projectInfo) {
                    window.location.href="/GeoProblemSolving/Projects/${projectInfo.projectId}"
                },

            }
        });




    </script>

    <style >
        [v-cloak]{
            display: none;
        }
        .picscreen {
            position: relative;
            transform: translateY(60px);
        }

        .picbg {
            background-image: url("../static/images/projectlistbg.jpg");
            background-size: cover;
            position: absolute;
            height: 280px;
            width: 100%;
            background-color: #8b8b8b;
            top: 0;
            left: 0;
        }

        .pictitle{
            font-size: 2.8rem;
            font-family: Georgia, sans-serif, serif;
            color: #ffffff;
            position: absolute;
            top: 30px;
            left: 100px;
        }
        .picdesc{
            font-size: 1.2rem;
            color: #f7faf7;
            position: absolute;
            top: 105px;
            left: 100px;
            display: block;
        }
        .project-start-btn{
            position: absolute;
            top: 200px;
            left: 55%;
            font-size: 1rem;
            border-radius: 6px;
            background-color: rgba(21, 88, 145, 0.4);
            color: rgba(255,255,255,1);
        }

        .search-btn{
            position: absolute;
            top: 30px;
            right: 50px;
            font-size: 0.5rem;
            width: 100px;
            text-align:right;
        }

        /*Tabs--style*/
        .tabs{
            transform: translateY(340px);
        }
        .tabpane-syle{
            font-size: 20px;
            background-color: rgba(133, 115, 92, 0.1);
            min-height: 500px;
        }
        .ivu-tabs-bar {
            /*border-bottom: 1px solid #dddee1;*/
            margin-bottom: 0px;
        }
        .ivu-tabs-nav-wrap {
            text-align: center;
            margin-bottom:0px;
        }
        .ivu-tabs-nav-scroll {
            display: inline-block;
        }
        .ivu-tabs-tab{
            font-size: 16px;

        }
        .ivu-row{
            margin-bottom: 45px;
        }

        .pro-page{
            position: absolute;
            bottom:  75px;
            left:38%;
            font-size:14px;
        }
        /* Loading动画的特效 */
        .demo-spin-icon-load {
            animation: ani-demo-spin 1s linear infinite;
        }
    </style>
</head>
<body>
<div id="vueBody" v-cloak>
    <child-navigation ref="navigationEl"></child-navigation>
    <div class="picscreen" >

        <div class="picbg"></div>
        <div class="home-content">
            <div>
                <span class="pictitle">Projects</span>
                <span class="picdesc">This is just an description.This is just an <br />description.This is just an description.This is just an description.</span>
                <i-button class="project-start-btn" @click="newProject"  type="default" >Create a project</i-button>
                <i-button class="search-btn" icon="icon ion-ios-search" @click=" ">Search...</i-button>
            </div>
        </div>
    </div>

    <div class="tabs">
        <Row>
            <i-col>
                <Spin fix v-show="getFinish">
                    <Icon type="icon ion-ios-loading" size="100" class="demo-spin-icon-load" color="yellowgreen"></Icon>
                    <div>Loading</div>
                </Spin>
                <div class="pro-tab">
                    <Tabs  v-model="currentTab" @on-click="changeTab" >
                        <tab-pane label="All" name="All" icon="md-list"></tab-pane>
                        <tab-pane label="Terrestrial"  name="Terrestrial" icon="md-globe"></tab-pane>
                        <tab-pane label="Coastal"  name="Coastal" icon="ios-boat"></tab-pane>
                        <tab-pane label="Marine"  name="Marine"  icon="ios-water"></tab-pane>
                        <tab-pane label="Climate"  name="Climate"  icon="ios-partly-sunny"></tab-pane>
                        <tab-pane label="Ecological"  name="Ecological"  icon="ios-leaf"></tab-pane>
                        <tab-pane label="Geological"  name="Geological"  icon="ios-analytics"></tab-pane>
                        <tab-pane label="Human-Activity"  name="Human"  icon="ios-people"></tab-pane>
                        <tab-pane label="GIS & RS"  name="GISRS"  icon="ios-globe"></tab-pane>
                        <tab-pane label="General"  name="General"  icon="ios-grid"></tab-pane>
                    </Tabs>
                </div>
                <div class="pro-content">
                    <tab-content  :project-list =  tabPageData ></tab-content >
                </div>
            </i-col>

        </Row>
        <div class="pro-page" >
            <Page  ref="pages" :total="totalCount" :page-size="pageSize"  :current="currentPage" size="small"  @on-change="changePage"   show-elevator show-total ></Page>
        </div>
        <div>
            <footer>
                <h2 class="footerTop">
                    <i>Open Geographic Modeling and Simulation</i>
                </h2>
                <p class="footerBottom">Copyright © 2013-2019 OpenGMS. All rights reserved.</p>
            </footer>
        </div>
    </div>

</div>
<script>
    window.onload=function () {
        var List = [{"projectId":"3f880f25-59e8-4ad2-a03d-4cfd4c867f78","title":"Participatory geoproblem solving","description":"Participatory geoproblem solving","category":"Human","managerId":"a9a5d60a-b7a4-4113-a523-c660a331b624","managerName":"mzy","introduction":"Participatory geo-problem solving","members":[{"userName":"luyuchen","userId":"1bfbe06c-be1e-40dc-bf13-bdd330ad607e"},{"userName":"zbc","userId":"172c8d44-6537-4e35-9ef7-068f1c48f67b"}],"privacy":"Public","tag":"participatory,collaboration","picture":"","createTime":"2019\/03\/27 22:51:04","endTime":""},{"projectId":"99f9f297-c945-4da0-9c69-024517a84c8d","title":"\u914D\u7F6E\u5F0F\u53EF\u89C6\u5316","description":"\u4E3A\u95E8\u6237\u7684DataItem\u7684\u6570\u636E\u8D44\u6E90\u63D0\u4F9B\u5728\u7EBF\u7684\u53EF\u4FBF\u6377\u7684\u3001\u53EF\u914D\u7F6E\u7684\u53EF\u89C6\u5316\u6548\u679C\u3002","category":"GISRS","managerId":"5a423517-3234-4205-a4ac-ce41b6c68bd0","managerName":"sunlingzhi","introduction":"\u4E3A\u95E8\u6237\u7684DataItem\u7684\u6570\u636E\u8D44\u6E90\u63D0\u4F9B\u5728\u7EBF\u7684\u53EF\u4FBF\u6377\u7684\u3001\u53EF\u914D\u7F6E\u7684\u53EF\u89C6\u5316\u6548\u679C\u3002","members":[],"privacy":"Public","tag":"\u53EF\u89C6\u5316,\u6570\u636E,UDX\u89C6\u56FE","picture":"","createTime":"2019\/03\/28 10:12:14","endTime":""},{"projectId":"93cc3106-f374-4436-8be1-0612c4234054","title":"VectorTile","description":"The building process of vector tile ","category":"GISRS","managerId":"dbbb1bd5-bb59-45c9-863a-062b967ecb4e","managerName":"Jingming","introduction":"The building process of vector tile ","members":[],"privacy":"Public","tag":"VectorTile","picture":"","createTime":"2019\/03\/30 11:06:35","endTime":""},{"projectId":"dc37a036-1ff7-4074-a42d-d064c525e770","title":"Online Saga GIS","description":"\u57FA\u4E8E saga GIS \u7684\u5728\u7EBF\u5730\u7406\u4FE1\u606F\u5206\u6790\u5E73\u53F0\u3002","category":"GISRS","managerId":"bf4950d6-4cdc-45af-9d0a-79eb8d90271a","managerName":"songjie","introduction":"\u672C\u8F6F\u4EF6\u662F\u5728\u9762\u5411\u670D\u52A1\u7684\u5206\u5E03\u5F0F\u6A21\u578B\u8D44\u6E90\u5171\u4EAB\u7684\u57FA\u7840\u4E0A\u4F7F\u7528\u6237\u80FD\u591F\u5728\u7EBF\u4F7F\u7528SAGA GIS\u5DE5\u5177\u5B9E\u73B0\u5730\u5B66\u5206\u6790\uFF0C\u907F\u514D\u96C6\u4E2D\u5F0F\u7684\u5EFA\u6A21\u4E0E\u6A21\u62DF\u73AF\u5883\u5E26\u6765\u7684\u5C01\u95ED\u6027\u5F0A\u7AEF\uFF0C\u5145\u5206\u5229\u7528\u5DF2\u6709\u7684\u6A21\u578B\u8D44\u6E90\uFF0C\u4FC3\u8FDB\u7F51\u7EDC\u7A7A\u95F4\u5F00\u653E\u5F0F\u5730\u7406\u5EFA\u6A21\u4E0E\u6A21\u62DF\u7406\u8BBA\u4E0E\u6280\u672F\u7684\u53D1\u5C55\uFF0C\u4E3A\u5730\u7406\u7814\u7A76\u8005\u63D0\u4F9B\u5F00\u653E\u3001\u9AD8\u6548\u7684\u5730\u7406\u95EE\u9898\u6C42\u89E3\u5E73\u53F0\u3002\n\u672C\u8F6F\u4EF6\u7684\u5730\u5B66\u5206\u6790\u529F\u80FD\u5305\u62EC\uFF1A\u6805\u683C\u3001\u77E2\u91CF\u6570\u636E\u7684\u5404\u79CD\u5904\u7406\uFF0C\u6C14\u5019\u76F8\u5173\u6570\u636E\u7684\u8BA1\u7B97\uFF0C\n\u9065\u611F\u5F71\u50CF\u5904\u7406\uFF0C\u7A7A\u95F4\u548C\u5730\u7406\u7EDF\u8BA1\u4EE5\u53CA\u5730\u5F62\u5206\u6790\u7B49\u3002\n","members":[{"userName":"yss123yss","userId":"faecf720-8462-4733-812e-d8ab276dca68"},{"userName":"zhangkai","userId":"26143ddf-9c89-413e-b8ca-502f1b35b606"}],"privacy":"Public","tag":"Geographic Information Analysis,Saga GIS","picture":"\/GeoProblemSolving\/project\/picture\/commen1065951.jpeg","createTime":"2019\/04\/20 11:27:23","endTime":""},{"projectId":"1a0271c3-ea65-4e9e-9526-be137041096e","title":"The simulation models of thr forest carbon cycle on a large sacle","description":"\u5730\u7403\u5316\u5B66\u6A21\u578B\u8FC7\u7A0B","category":"Ecological","managerId":"ce9e38f1-d4b2-4f8a-b461-2aae31c44b7a","managerName":"zzy","introduction":"\u5730\u7403\u5316\u5B66\u6A21\u578B\u8FC7\u7A0B","members":[],"privacy":"Public","tag":"","picture":"","createTime":"2019\/04\/22 15:19:56","endTime":""},{"projectId":"b473c6fc-9352-416e-9c0d-667e9ae87b83","title":"Thinking in Future GIS","description":"a collection of resource for future gis","category":"General","managerId":"bd077e63-478f-4ede-8a1e-ef7cf9827b11","managerName":"laowine","introduction":"this is a project attempting to discover the possible way to implement future GIS","members":[],"privacy":"Public","tag":"GIS ,Future GIS","picture":"\/GeoProblemSolving\/project\/picture\/worldtopobathymini254932.jpg","createTime":"2019\/04\/25 19:34:06","endTime":""}];
        new Vue({
            el: '#vueBody',
            data: {
                getFinish: false,
                currentProjectList:  List,
                projectShowList: List.slice(0,18),
                projectType:[],
                currentTab:"All",
                //初始化信息总条数
                //projectCount:10,
                currentPage:1 ,
                totalCount:List.length,
                //每页显示多少条
                pageSize:18,
                userInfo:[],
                tabPageData:List.slice(0,18),
                tabPaneType:[{  label:"All",name:"All",icon:"icon ion-md-list"},
                    { label:"Terrestrial", name:"Terrestrial", icon:"icon ion-md-globe"},
                    {label:"Coastal", name:"Coastal",icon:"icon ion-ios-boat"},
                    {label:"Marine", name:"Marine", icon:"icon ion-ios-water"},
                    {label:"Climate", name:"Climate", icon:"icon ion-ios-partly-sunny"},
                    {label:"Ecological", name:"Ecological", icon:"icon ion-ios-leaf"},
                    {label:"Geological", name:"Geological", icon:"icon ion-ios-analytics"},
                    {label:"Human-Activity", name:"Human" ,icon:"icon ion-ios-people"},
                    {label:"GIS & RS", name:"GISRS" ,icon:"icon ion-ios-globe"},
                    {label:"General", name:"General", icon:"icon ion-ios-grid"}
                ],
            },
            created(){
                var userInfo=JSON.parse(sessionStorage.getItem("userInfo"));
            },
            methods: {
                changeTab(type) {
                    this.currentTab=type;
                    this.currentPage=1;
                    this.$nextTick(function(){
                        this.$refs['pages'].currentPage = 1;
                    });

                    if(type=="All"){
                        this.tabPageData=Object.assign([], this.projectShowList);
                        this.totalCount=List.length;
                    }
                    else{
                        this.changePage(1);
                    }
                },
                changePage(index){
                    if(this.currentTab=="All" && index==1){
                        this.tabPageData=Object.assign([], this.projectShowList);
                        this.totalCount=List.length;
                    }
                    else{
                        axios
                            .get("/GeoProblemSolving/project/inquiryByPage",{
                                params:{
                                    category:this.currentTab,
                                    page:index,
                                    pageSize:this.pageSize,
                                }
                            })
                            .then(res => {
                                console.log(index);
                                this.getFinish = false;
                                if (res.data === "None") {
                                    this.currentProjectList = [];
                                } else {
                                    //this.judgeMember(res.data.projectList);
                                }
                                this.tabPageData = Object.assign([], res.data.projectList);
                                this.totalCount=res.data.count;
                                console.log(res.data)
                            })
                            .catch(err => {
                                console.log(err.data);
                            });
                    }


                },
                newProject() {
                },


            }
        })
    }
</script>

</body>
</html>