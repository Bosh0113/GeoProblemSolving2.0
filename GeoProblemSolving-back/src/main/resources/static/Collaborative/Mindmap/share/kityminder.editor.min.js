/*!
 * ====================================================
 * kityminder-editor - v1.0.67 - 2020-01-07
 * https://github.com/fex-team/kityminder-editor
 * GitHub: https://github.com/fex-team/kityminder-editor 
 * Copyright (c) 2020 ; Licensed 
 * ====================================================
 */


!function(){var c={r:function(e){if(c[e].inited)return c[e].value;if("function"!=typeof c[e].value)return c[e].inited=!0,c[e].value;var t={exports:{}},n=c[e].value(null,t.exports,t);if(c[e].inited=!0,void 0!==(c[e].value=n))return n;for(var i in t.exports)if(t.exports.hasOwnProperty(i))return c[e].inited=!0,c[e].value=t.exports,t.exports}};c[0]={value:function(e,t,n){var i=[];function r(e){i.push(e)}function a(e){this.selector=e;for(var t=0;t<i.length;t++)"function"==typeof i[t]&&i[t].call(this,this)}return(a.assemble=r)(c.r(7)),r(c.r(8)),r(c.r(9)),n.exports=a}},c[1]={value:function(e,t,n){return n.exports=kityminder.Editor=c.r(0)}},c[2]={value:function(e,t,n){return n.exports=window.HotBox}},c[3]={value:function(e,t,n){}},c[4]={value:function(e,t,n){return n.exports=window.kityminder.Minder}},c[5]={value:function(e,t,n){function i(){var n="\ufeff",i={"application/km":"￿"},r={"\ufeff":"SPLITOR","￿":"application/km"};function a(e,t){if(!this.isPureText(t)){if(!this.whichMimeType(t))throw new Error("unknow mimetype!");t=this.getPureText(t)}return!1===e?t:e+n+t}this.registMimeTypeProtocol=function(e,t){if(t&&r[t])throw new Error("sing has registed!");if(e&&i[e])throw new Error("mimetype has registed!");r[t]=e,i[e]=t},this.getMimeTypeProtocol=function(e,t){var n=i[e]||!1;return void 0===t?a.bind(this,n):a(n,t)},this.getSpitor=function(){return n},this.getMimeType=function(e){return void 0!==e?r[e]||null:i}}return i.prototype.isPureText=function(e){return!~e.indexOf(this.getSpitor())},i.prototype.getPureText=function(e){return this.isPureText(e)?e:e.split(this.getSpitor())[1]},i.prototype.whichMimeType=function(e){return this.isPureText(e)?null:this.getMimeType(e.split(this.getSpitor())[0])},n.exports=function(){this.minder.supportClipboardEvent&&!kity.Browser.gecko&&(this.MimeType=new i)}}},c[6]={value:function(e,t,n){return n.exports=function(){var d=this.minder,r=window.kityminder.data;if(d.supportClipboardEvent&&!kity.Browser.gecko){var c=this.fsm,u=this.receiver,s=this.MimeType,a=s.getMimeTypeProtocol("application/km"),m=r.getRegisterProtocol("json").decode,p=[];document.addEventListener("copy",function(e){if(document.activeElement==u.element){var t=e;switch(c.state()){case"input":break;case"normal":var n=[].concat(d.getSelectedNodes());if(n.length){var i;if(1<n.length&&(n.sort(function(e,t){return e.getLevel()-t.getLevel()}),(i=n[0].getLevel())!==n[n.length-1].getLevel())){var r,a=0,o=n.length,l=o-1;for(r=n[l];r.getLevel()!==i;){for(a=0;a<o&&n[a].getLevel()===i;){if(n[a].isAncestorOf(r)){n.splice(l,1);break}a++}r=n[--l]}}var s=g(n);t.clipboardData.setData("text/plain",s)}e.preventDefault()}}}),document.addEventListener("cut",function(e){if(document.activeElement==u.element){if("normal"!==d.getStatus())return void e.preventDefault();var t=e;switch(c.state()){case"input":break;case"normal":var n=d.getSelectedNodes();n.length&&(t.clipboardData.setData("text/plain",g(n)),d.execCommand("removenode")),e.preventDefault()}}}),document.addEventListener("paste",function(e){if(document.activeElement==u.element){if("normal"!==d.getStatus())return void e.preventDefault();var t=e,n=c.state(),i=t.clipboardData.getData("text/plain");switch(n){case"input":if(!s.isPureText(i))return void e.preventDefault();break;case"normal":var r=d.getSelectedNodes();if("application/km"===s.whichMimeType(i)){var a,o=m(s.getPureText(i));r.forEach(function(e){for(var t=o.length-1;0<=t;t--)a=d.createNode(null,e),d.importNode(a,o[t]),p.push(a),e.appendChild(a)}),d.select(p,!0),p=[],d.refresh()}else{if(t.clipboardData&&-1<t.clipboardData.items[0].type.indexOf("image")){var l=t.clipboardData.items[0].getAsFile();return angular.element(document.body).injector().get("server").uploadImage(l).then(function(e){var t=e.data;0===t.errno&&d.execCommand("image",t.data.url)})}r.forEach(function(e){d.Text2Children(e,i)})}e.preventDefault()}}})}function g(e){for(var t=[],n=0,i=e.length;n<i;n++)t.push(d.exportNode(e[n]));return a(r.getRegisterProtocol("json").encode(t))}}}},c[7]={value:function(e,t,n){return n.exports=function(){var e;if(!(e="string"==typeof this.selector?document.querySelector(this.selector):this.selector))throw new Error("Invalid selector: "+this.selector);e.classList.add("km-editor"),this.container=e}}},c[8]={value:function(e,t,n){var s=new(c.r(10))("fsm");function d(e,t,n,i){return e.when==t&&(("*"==e.enter||e.enter==i)&&("*"==e.exit||e.exit==n||void 0))}return n.exports=function(){this.fsm=new function(e){var o=e,l=[];this.jump=function(e,t){if(!t)throw new Error("Please tell fsm the reason to jump");var n,i,r=o,a=[r,e].concat([].slice.call(arguments,1));for(n=0;n<l.length;n++)if(d((i=l[n]).condition,"before",r,e)&&i.apply(null,a))return;for(o=e,s.log("[{0}] {1} -> {2}",t,r,e),n=0;n<l.length;n++)d((i=l[n]).condition,"after",r,e)&&i.apply(null,a);return o},this.state=function(){return o},this.when=function(e,t){var n,i,r,a;if(1==arguments.length&&(t=e,e="* -> *"),2==(i=e.split(" - ")).length?n="before":2==(i=e.split(" -> ")).length&&(n="after"),!n)throw new Error("Illegal fsm condition: "+e);r=i[0],a=i[1],t.condition={when:n,exit:r,enter:a},l.push(t)}}("normal")}}},c[9]={value:function(e,t,n){var i=c.r(4);return n.exports=function(){var e=new i({enableKeyReceiver:!1,enableAnimation:!0});e.renderTo(this.selector),e.setTheme(null),e.select(e.getRoot(),!0),e.execCommand("text","Main topic"),this.minder=e}}},c[10]={value:function(e,t,n){var i=c.r(11);function r(){}return n.exports=function(t){if(this.flaged=-1!=window.location.search.indexOf(t)){var e=function(e){for(var t=0,n=0;n<e.length;n++)t+=e.charCodeAt(n);return t}(t)%360,n=i("background: hsl({0}, 50%, 80%); color: hsl({0}, 100%, 30%); padding: 2px 3px; margin: 1px 3px 0 0;border-radius: 2px;",e);this.log=function(){var e=i.apply(null,arguments);console.log(i("%c{0}%c{1}",t,e),n,"background: none; color: black;")}}else this.log=r}}},c[11]={value:function(e,t,n){return n.exports=function(e,n){return"object"!=typeof n&&(n=[].slice.call(arguments,1)),String(e).replace(/\{(\w+)\}/gi,function(e,t){return n[t]||t})}}},c[12]={value:function(e,t,n){!("innerText"in document.createElement("a"))&&"getSelection"in window&&(HTMLElement.prototype.__defineGetter__("innerText",function(){var e,t,n=window.getSelection(),i=[];for(t=0;t<n.rangeCount;t++)i[t]=n.getRangeAt(t);for(n.removeAllRanges(),n.selectAllChildren(this),e=n.toString(),n.removeAllRanges(),t=0;t<i.length;t++)n.addRange(i[t]);return e}),HTMLElement.prototype.__defineSetter__("innerText",function(e){this.innerHTML=(e||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}))}},c[13]={value:function(e,t,n){var m=Object.keys?Object.keys:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};function p(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function g(e){return"object"==typeof e?JSON.parse(JSON.stringify(e)):e}return n.exports=function(e,t){var n=[];return function e(t,n,i,r){for(var a=m(n),o=m(t),l=!1,s=o.length-1;0<=s;s--){var d=t[u=o[s]];if(n.hasOwnProperty(u)){var c=n[u];"object"==typeof d&&null!=d&&"object"==typeof c&&null!=c?e(d,c,i,r+"/"+p(u)):d!=c&&i.push({op:"replace",path:r+"/"+p(u),value:g(c)})}else i.push({op:"remove",path:r+"/"+p(u)}),l=!0}if(l||a.length!=o.length)for(s=0;s<a.length;s++){var u=a[s];t.hasOwnProperty(u)||i.push({op:"add",path:r+"/"+p(u),value:g(n[u])})}}(e,t,n,""),n}}},c[14]={value:function(e,t,n){var i=c.r(15),r=4096,a=8192,o=16384;function l(e){return"string"==typeof e?(t=0,e.toLowerCase().split(/\s*\+\s*/).forEach(function(e){switch(e){case"ctrl":case"cmd":t|=r;break;case"alt":t|=a;break;case"shift":t|=o;break;default:t|=i[e]}}),t):function(e){var t=0;(e.ctrlKey||e.metaKey)&&(t|=r);e.altKey&&(t|=a);e.shiftKey&&(t|=o);if(-1===[16,17,18,91].indexOf(e.keyCode)){if(229===e.keyCode&&e.keyIdentifier)return t|=parseInt(e.keyIdentifier.substr(2),16);t|=e.keyCode}return t}(e);var t}t.hash=l,t.is=function(e,t){return e&&t&&l(e)==l(t)}}},c[15]={value:function(e,t,n){var i={Shift:16,Control:17,Alt:18,CapsLock:20,BackSpace:8,Tab:9,Enter:13,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,Direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190};for(var r in i)i.hasOwnProperty(r)&&(i[r.toLowerCase()]=i[r]);var a="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach(function(e){i[e]=e.charCodeAt(0)-a+65});for(var o=9;i[o.toString()]=o+48,--o;);n.exports=i}};var e,t={"expose-editor":1};angular.module("kityminderEditor",["ui.bootstrap","ui.codemirror","ui.colorpicker"]).config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self","http://agroup.baidu.com:8910/**","http://cq01-fe-rdtest01.vm.baidu.com:8910/**","http://agroup.baidu.com:8911/**"])}]),angular.module("kityminderEditor").run(["$templateCache",function(e){"use strict";e.put("ui/directive/appendNode/appendNode.html","<div class=\"km-btn-group append-group\"><div class=\"km-btn-item append-child-node\" ng-disabled=\"minder.queryCommandState('AppendChildNode') === -1\" ng-click=\"minder.queryCommandState('AppendChildNode') === -1 || execCommand('AppendChildNode')\" title=\"{{ 'appendchildnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'appendchildnode' | lang:'ui/command' }}</span></div><div class=\"km-btn-item append-parent-node\" ng-disabled=\"minder.queryCommandState('AppendParentNode') === -1\" ng-click=\"minder.queryCommandState('AppendParentNode') === -1 || execCommand('AppendParentNode')\" title=\"{{ 'appendparentnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'appendparentnode' | lang:'ui/command' }}</span></div><div class=\"km-btn-item append-sibling-node\" ng-disabled=\"minder.queryCommandState('AppendSiblingNode') === -1\" ng-click=\"minder.queryCommandState('AppendSiblingNode') === -1 ||execCommand('AppendSiblingNode')\" title=\"{{ 'appendsiblingnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'appendsiblingnode' | lang:'ui/command' }}</span></div></div>"),e.put("ui/directive/arrange/arrange.html","<div class=\"km-btn-group arrange-group\"><div class=\"km-btn-item arrange-up\" ng-disabled=\"minder.queryCommandState('ArrangeUp') === -1\" ng-click=\"minder.queryCommandState('ArrangeUp') === -1 || minder.execCommand('ArrangeUp')\" title=\"{{ 'arrangeup' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'arrangeup' | lang:'ui/command' }}</span></div><div class=\"km-btn-item arrange-down\" ng-disabled=\"minder.queryCommandState('ArrangeDown') === -1\" ng-click=\"minder.queryCommandState('ArrangeDown') === -1 || minder.execCommand('ArrangeDown');\" title=\"{{ 'arrangedown' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'arrangedown' | lang:'ui/command' }}</span></div></div>"),e.put("ui/directive/collabPanel/collabPanel.html",'<div style="float: right"><span class="glyphicon glyphicon-link" aria-hidden="true" title="Click it and start collaboration" ng-show="!collaboration" style="margin-left: 10px;cursor:pointer;margin-right: 30px" ng-click="startCollab()"></span> <span class="glyphicon glyphicon-globe" aria-hidden="true" title="Click it and stop collaboration" ng-show="collaboration" style="margin-left: 10px;cursor:pointer;margin-right: 30px" ng-click="stopCollab()"></span> <span class="glyphicon glyphicon-pencil" aria-hidden="true" title="Apply to draw the mind map" ng-show="!draw" style="cursor:pointer;margin-right: 20px" ng-click="applyCtrl()"></span> <span class="glyphicon glyphicon-refresh" id="giveup-ctrl" aria-hidden="true" title="Give up to draw the mind map" ng-show="draw" style="cursor:pointer;margin-right: 20px" ng-click="giveupCtrl()"></span> <span class="glyphicon glyphicon-user" aria-hidden="true" title="{{drawer}} is drawing the mind map" style="margin-right: 10px" ng-show="draw"></span> <span ng-show="draw" style="margin-right: 10px;margin-left: 10px">{{leftApply}} people waiting for drawing.</span> <span data-toggle="modal" data-target="#onlineUsers" style="max-width: 500px; overflow: hidden; cursor: pointer"><span class="glyphicon glyphicon-user" aria-hidden="true" ng-repeat="user in participants" title="{{user.name}}" style="margin-left: 15px;margin-right: 5px"></span>...</span><div class="modal fade" id="onlineUsers" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="color: black"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel">Online participants</h4></div><div class="modal-body"><div style="min-height: 100px"><div style="float:left; cursor: pointer" id="collaPanel" ng-repeat="user in participants" ng-click="gotoUserspace(user.id)"><span class="glyphicon glyphicon-user" style="margin-right: 5px"></span><span>{{user.name}}</span></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div></div>'),e.put("ui/directive/colorPanel/colorPanel.html",'<div class="bg-color-wrap"><span class="quick-bg-color" ng-click="minder.queryCommandState(\'background\') === -1 || minder.execCommand(\'background\', bgColor)" ng-disabled="minder.queryCommandState(\'background\') === -1"></span> <span color-picker class="bg-color" set-color="setDefaultBg()" ng-disabled="minder.queryCommandState(\'background\') === -1"><span class="caret"></span></span> <span class="bg-color-preview" ng-style="{ \'background-color\': bgColor }" ng-click="minder.queryCommandState(\'background\') === -1 || minder.execCommand(\'background\', bgColor)" ng-disabled="minder.queryCommandState(\'background\') === -1"></span></div>'),e.put("ui/directive/expandLevel/expandLevel.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default expand" title="{{ \'expandtoleaf\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="minder.execCommand(\'ExpandToLevel\', 9999)"></button> <button type="button" class="btn btn-default expand-caption dropdown-toggle" title="{{ \'expandtoleaf\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'expandtoleaf\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'expandtoleaf\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="level in levels"><a href ng-click="minder.execCommand(\'ExpandToLevel\', level)">{{ \'expandtolevel\' + level | lang:\'ui/command\' }}</a></li></ul></div>'),e.put("ui/directive/fileImport/fileImport.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default import" title="{{ \'import\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" data-toggle="modal" data-target="#importModal" ng-click="updateMaplist()"></button> <button type="button" class="btn btn-default import-caption dropdown-toggle" data-toggle="modal" data-target="#importModal" title="{{ \'import\' | lang:\'ui\' }}" ng-click="updateMaplist()"><span class="caption">{{ \'import\' | lang:\'ui\' }}</span> <span class="sr-only">{{ \'import\' | lang:\'ui\' }}</span></button><div class="modal fade" id="importModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog" style="width: 800px"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel">Import mind map</h4></div><div class="modal-body" style="font-size: 12px"><div style="width: 95%; margin: auto; border: 1px solid gray"><table class="table" style="width: 90%; margin: auto"><caption style="font-size: 14px;font-weight: 600;color:#333">Open mindmap from resource center:</caption><thead><tr><th style="width: 30%">Name</th><th style="width: 50%">Description</th><th style="width: 20%">Operation</th></tr></thead></table><div style="min-height:100px;max-height: 400px; overflow-y: auto"><table class="table" style="width: 90%;margin: auto"><tbody><tr ng-repeat="item in mindmapRes"><td style="width: 30%">{{item.name}}</td><td style="width: 50%">{{item.description}}</td><td style="width: 20%"><span style="cursor:pointer" class="glyphicon glyphicon-ok-circle" title="Load this mindmap" ng-click="mapLoad(item)"></span> <span style="cursor:pointer; margin-left: 20px" class="glyphicon glyphicon-remove-circle" title="Delete this mindmap" ng-click="deleteMap(item)"></span></td></tr></tbody></table></div></div><div style="width: 90%; margin: auto;margin-top: 30px"><span style="font-size: 14px;font-weight: 600">Open mindmap from resource center:</span> <input type="file" id="fileInput" style="margin-top: 15px"><button type="button" class="btn btn-info" style="margin-top: 15px" ng-click="mapImport()">Upload</button></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div></div>'),e.put("ui/directive/fileSave/fileSave.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default save" title="{{ \'save\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}"></button> <button type="button" class="btn btn-default save-caption dropdown-toggle" title="{{ \'save\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'save\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'save\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li data-toggle="modal" data-target="#saveModal"><a href>Save</a></li><li data-toggle="modal" data-target="#saveasModal"><a href>Save as</a></li></ul><div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel">Save mind map</h4></div><div class="modal-body"><div style="margin: 10px 0"><button type="button" class="btn btn-info" id="saveBtn" ng-click="saveMapFun()">Save to resource center</button> <button style="margin-left: 20px" type="button" id="downloadBtn" ng-click="downloadMapFun()" class="btn btn-info">Download</button></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div><div class="modal fade" id="saveasModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel">Save mind map</h4></div><div class="modal-body"><div><span style="font-size: 16px; margin-right: 20px">Save the current mind map as format:</span><select class="form-control" style="width:100px; display: initial" id="datatypeSelect"><option>json</option><option>md</option><option>km</option><option>png</option></select></div><div class="input-group" style="margin-top: 20px"><span class="input-group-addon">File name:</span> <input type="text" class="form-control" id="mindmapName" placeholder="Please fill in the name"></div><div style="margin-top: 20px"><button type="button" class="btn btn-info" id="saveBtn" ng-click="saveasMapFun()">Save to resource center</button> <button style="float: right" type="button" id="downloadBtn" ng-click="downloadMapFun()" class="btn btn-info">Download</button></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div></div></div></div>'),e.put("ui/directive/fontOperator/fontOperator.html",'<div class="font-operator"><div class="dropdown font-family-list" dropdown><div class="dropdown-toggle current-font-item" dropdown-toggle ng-disabled="minder.queryCommandState(\'fontfamily\') === -1"><a href class="current-font-family" title="{{ \'fontfamily\' | lang: \'ui\' }}">{{ getFontfamilyName(minder.queryCommandValue(\'fontfamily\')) || \'Font family\' }}</a> <span class="caret"></span></div><ul class="dropdown-menu font-list"><li ng-repeat="f in fontFamilyList" class="font-item-wrap"><a ng-click="minder.execCommand(\'fontfamily\', f.val)" class="font-item" ng-class="{ \'font-item-selected\' : f == minder.queryCommandValue(\'fontfamily\') }" ng-style="{\'font-family\': f.val }">{{ f.name }}</a></li></ul></div><div class="dropdown font-size-list" dropdown><div class="dropdown-toggle current-font-item" dropdown-toggle ng-disabled="minder.queryCommandState(\'fontsize\') === -1"><a href class="current-font-size" title="{{ \'fontsize\' | lang: \'ui\' }}">{{ minder.queryCommandValue(\'fontsize\') || \'Font size\' }}</a> <span class="caret"></span></div><ul class="dropdown-menu font-list"><li ng-repeat="f in fontSizeList" class="font-item-wrap"><a ng-click="minder.execCommand(\'fontsize\', f)" class="font-item" ng-class="{ \'font-item-selected\' : f == minder.queryCommandValue(\'fontsize\') }" ng-style="{\'font-size\': f + \'px\'}">{{ f }}</a></li></ul></div><span class="s-btn-icon font-bold" ng-click="minder.queryCommandState(\'bold\') === -1 || minder.execCommand(\'bold\')" ng-class="{\'font-bold-selected\' : minder.queryCommandState(\'bold\') == 1}" ng-disabled="minder.queryCommandState(\'bold\') === -1"></span> <span class="s-btn-icon font-italics" ng-click="minder.queryCommandState(\'italic\') === -1 || minder.execCommand(\'italic\')" ng-class="{\'font-italics-selected\' : minder.queryCommandState(\'italic\') == 1}" ng-disabled="minder.queryCommandState(\'italic\') === -1"></span><div class="font-color-wrap"><span class="quick-font-color" ng-click="minder.queryCommandState(\'forecolor\') === -1 || minder.execCommand(\'forecolor\', foreColor)" ng-disabled="minder.queryCommandState(\'forecolor\') === -1">A</span> <span color-picker class="font-color" set-color="setDefaultColor()" ng-disabled="minder.queryCommandState(\'forecolor\') === -1"><span class="caret"></span></span> <span class="font-color-preview" ng-style="{ \'background-color\': foreColor }" ng-click="minder.queryCommandState(\'forecolor\') === -1 || minder.execCommand(\'forecolor\', foreColor)" ng-disabled="minder.queryCommandState(\'forecolor\') === -1"></span></div><color-panel minder="minder" class="inline-directive"></color-panel></div>'),e.put("ui/directive/hyperLink/hyperLink.html",'<div class="btn-group-vertical" dropdown is-open="isopen" style="cursor:not-allowed"><button type="button" class="btn btn-default hyperlink" title="{{ \'link\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" style="cursor:not-allowed" ng-disabled="minder.queryCommandState(\'HyperLink\') === -1"></button> <button type="button" class="btn btn-default hyperlink-caption dropdown-toggle" ng-disabled="minder.queryCommandState(\'HyperLink\') === -1" title="{{ \'link\' | lang:\'ui\' }}" style="cursor:not-allowed" dropdown-toggle><span class="caption">{{ \'link\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'link\' | lang:\'ui\' }}</span></button></div>'),e.put("ui/directive/imageBtn/imageBtn.html",'<div class="btn-group-vertical" dropdown is-open="isopen" style="cursor:not-allowed"><button type="button" class="btn btn-default image-btn" title="{{ \'image\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" style="cursor:not-allowed" ng-disabled="minder.queryCommandState(\'Image\') === -1"></button> <button type="button" class="btn btn-default image-btn-caption dropdown-toggle" ng-disabled="minder.queryCommandState(\'Image\') === -1" title="{{ \'image\' | lang:\'ui\' }}" style="cursor:not-allowed" dropdown-toggle><span class="caption">{{ \'image\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'image\' | lang:\'ui\' }}</span></button></div>'),e.put("ui/directive/kityminderEditor/kityminderEditor.html",'<div class="minder-editor-container"><div class="minder-editor" style="top:0px"></div><div class="km-note" note-editor minder="minder" ng-if="minder"></div><div class="note-previewer" note-previewer ng-if="minder"></div><div class="navigator" navigator minder="minder" ng-if="minder"></div></div>'),e.put("ui/directive/kityminderViewer/kityminderViewer.html",'<div class="minder-editor-container"><div class="minder-viewer"></div><div class="note-previewer" note-previewer ng-if="minder"></div><div class="navigator" navigator minder="minder" ng-if="minder"></div></div>'),e.put("ui/directive/layout/layout.html",'<div class="readjust-layout"><a ng-click="minder.queryCommandState(\'resetlayout\') === -1 || minder.execCommand(\'resetlayout\')" class="btn-wrap" ng-disabled="minder.queryCommandState(\'resetlayout\') === -1"><span class="btn-icon reset-layout-icon"></span> <span class="btn-label">{{ \'resetlayout\' | lang: \'ui/command\' }}</span></a></div>'),e.put("ui/directive/navigator/navigator.html",'<div class="nav-bar"><div class="nav-btn zoom-in" ng-click="minder.execCommand(\'zoomIn\')" title="{{ \'zoom-in\' | lang : \'ui\' }}" ng-class="{ \'active\' : getZoomRadio(zoom) == 0 }"><div class="icon"></div></div><div class="zoom-pan"><div class="origin" ng-style="{\'transform\': \'translate(0, \' + getHeight(100) + \'px)\'}" ng-click="minder.execCommand(\'zoom\', 100);"></div><div class="indicator" ng-style="{\r\n             \'transform\': \'translate(0, \' + getHeight(zoom) + \'px)\',\r\n             \'transition\': \'transform 200ms\'\r\n             }"></div></div><div class="nav-btn zoom-out" ng-click="minder.execCommand(\'zoomOut\')" title="{{ \'zoom-out\' | lang : \'ui\' }}" ng-class="{ \'active\' : getZoomRadio(zoom) == 1 }"><div class="icon"></div></div><div class="nav-btn hand" ng-click="minder.execCommand(\'hand\')" title="{{ \'hand\' | lang : \'ui\' }}" ng-class="{ \'active\' : minder.queryCommandState(\'hand\') == 1 }"><div class="icon"></div></div><div class="nav-btn camera" ng-click="minder.execCommand(\'camera\', minder.getRoot(), 600);" title="{{ \'camera\' | lang : \'ui\' }}"><div class="icon"></div></div><div class="nav-btn nav-trigger" ng-class="{\'active\' : isNavOpen}" ng-click="toggleNavOpen()" title="{{ \'navigator\' | lang : \'ui\' }}"><div class="icon"></div></div></div><div class="nav-previewer" ng-show="isNavOpen"></div>'),e.put("ui/directive/noteBtn/noteBtn.html",'<div class="btn-group-vertical note-btn-group" dropdown is-open="isopen"><button type="button" class="btn btn-default note-btn" title="{{ \'note\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="addNote()" ng-disabled="minder.queryCommandState(\'note\') === -1"></button> <button type="button" class="btn btn-default note-btn-caption dropdown-toggle" ng-disabled="minder.queryCommandState(\'note\') === -1" title="{{ \'note\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'note\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'note\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li><a href ng-click="addNote()">{{ \'insertnote\' | lang:\'ui\' }}</a></li><li><a href ng-click="minder.execCommand(\'note\', null)">{{ \'removenote\' | lang:\'ui\' }}</a></li></ul></div>'),e.put("ui/directive/noteEditor/noteEditor.html",'<div class="panel panel-default" ng-init="noteEditorOpen = false" ng-show="noteEditorOpen"><div class="panel-heading"><h3 class="panel-title">Note</h3><span>（<a class="help" href="https://www.zybuluo.com/techird/note/46064" target="_blank">Support GFM writing grammar</a>）</span> <i class="close-note-editor glyphicon glyphicon-remove" ng-click="closeNoteEditor()"></i></div><div class="panel-body"><div ng-show="noteEnabled" ui-codemirror="{ onLoad: codemirrorLoaded }" ng-model="noteContent" ui-codemirror-opts="{\r\n                gfm: true,\r\n                breaks: true,\r\n                lineWrapping : true,\r\n                mode: \'gfm\',\r\n                dragDrop: false,\r\n                lineNumbers:true\r\n             }"></div><p ng-show="!noteEnabled" class="km-note-tips">Please select one node to add notes</p></div></div>'),e.put("ui/directive/notePreviewer/notePreviewer.html",'<div id="previewer-content" ng-show="showNotePreviewer" ng-style="previewerStyle" ng-bind-html="noteContent"></div>'),e.put("ui/directive/operation/operation.html","<div class=\"km-btn-group operation-group\"><div class=\"km-btn-item edit-node\" ng-disabled=\"minder.queryCommandState('text') === -1\" ng-click=\"minder.queryCommandState('text') === -1 || editNode()\" title=\"{{ 'editnode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'editnode' | lang:'ui/command' }}</span></div><div class=\"km-btn-item remove-node\" ng-disabled=\"minder.queryCommandState('RemoveNode') === -1\" ng-click=\"minder.queryCommandState('RemoveNode') === -1 || minder.execCommand('RemoveNode');\" title=\"{{ 'removenode' | lang:'ui/command' }}\"><i class=\"km-btn-icon\"></i> <span class=\"km-btn-caption\">{{ 'removenode' | lang:'ui/command' }}</span></div></div>"),e.put("ui/directive/priorityEditor/priorityEditor.html",'<ul class="km-priority tool-group" ng-disabled="commandDisabled"><li class="km-priority-item tool-group-item" ng-repeat="p in priorities" ng-click="commandDisabled || minder.execCommand(\'priority\', p)" ng-class="{ active: commandValue == p }" title="{{ getPriorityTitle(p) }}"><div class="km-priority-icon tool-group-icon priority-{{p}}"></div></li></ul>'),e.put("ui/directive/progressEditor/progressEditor.html",'<ul class="km-progress tool-group" ng-disabled="commandDisabled"><li class="km-progress-item tool-group-item" ng-repeat="p in progresses" ng-click="commandDisabled || minder.execCommand(\'progress\', p)" ng-class="{ active: commandValue == p }" title="{{ getProgressTitle(p) }}"><div class="km-progress-icon tool-group-icon progress-{{p}}"></div></li></ul>'),e.put("ui/directive/resourceEditor/resourceEditor.html",'<div class="resource-editor"><div class="input-group"><input class="form-control" type="text" ng-model="newResourceName" ng-required ng-keypress="$event.keyCode == 13 && addResource(newResourceName)" ng-disabled="!enabled"> <span class="input-group-btn"><button class="btn btn-default" ng-click="addResource(newResourceName)" ng-disabled="!enabled">Add</button></span></div><div class="resource-dropdown clearfix" id="resource-dropdown"><ul class="km-resource" ng-init="resourceListOpen = false" ng-class="{\'open\': resourceListOpen}"><li ng-repeat="resource in used" ng-disabled="!enabled" ng-blur="blurCB()"><label style="background: {{resourceColor(resource.name)}}"><input type="checkbox" ng-model="resource.selected" ng-disabled="!enabled"> <span>{{resource.name}}</span></label></li></ul><div class="resource-caret" click-anywhere-but-here="resourceListOpen = false" is-active="resourceListOpen" ng-click="resourceListOpen = !resourceListOpen"><span class="caret"></span></div></div></div>'),e.put("ui/directive/searchBox/searchBox.html",'<div id="search" class="search-box clearfix" ng-show="showSearch"><div class="input-group input-group-sm search-input-wrap"><input type="text" id="search-input" class="form-control search-input" ng-model="keyword" ng-keydown="handleKeyDown($event)" aria-describedby="basic-addon2"> <span class="input-group-addon search-addon" id="basic-addon2" ng-show="showTip" ng-bind="\'第 \' + curIndex + \' 条，共 \' + resultNum + \' 条\'"></span></div><div class="btn-group btn-group-sm prev-and-next-btn" role="group"><button type="button" class="btn btn-default" ng-click="doSearch(keyword, \'prev\')"><span class="glyphicon glyphicon-chevron-up"></span></button> <button type="button" class="btn btn-default" ng-click="doSearch(keyword, \'next\')"><span class="glyphicon glyphicon-chevron-down"></span></button></div><div class="close-search" ng-click="exitSearch()"><span class="glyphicon glyphicon-remove"></span></div></div>'),e.put("ui/directive/searchBtn/searchBtn.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default search" title="{{ \'search\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="enterSearch()"></button> <button type="button" class="btn btn-default search-caption dropdown-toggle" ng-click="enterSearch()" title="{{ \'search\' | lang:\'ui\' }}"><span class="caption">{{ \'search\' | lang:\'ui\' }}</span> <span class="sr-only">{{ \'search\' | lang:\'ui\' }}</span></button></div>'),e.put("ui/directive/selectAll/selectAll.html",'<div class="btn-group-vertical" dropdown is-open="isopen"><button type="button" class="btn btn-default select" title="{{ \'selectall\' | lang:\'ui\' }}" ng-class="{\'active\': isopen}" ng-click="select[\'all\']()"></button> <button type="button" class="btn btn-default select-caption dropdown-toggle" title="{{ \'selectall\' | lang:\'ui\' }}" dropdown-toggle><span class="caption">{{ \'selectall\' | lang:\'ui\' }}</span> <span class="caret"></span> <span class="sr-only">{{ \'selectall\' | lang:\'ui\' }}</span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="item in items"><a href ng-click="select[item]()">{{ \'select\' + item | lang:\'ui\' }}</a></li></ul></div>'),e.put("ui/directive/styleOperator/styleOperator.html",'<div class="style-operator"><a ng-click="minder.queryCommandState(\'clearstyle\') === -1 || minder.execCommand(\'clearstyle\')" class="btn-wrap clear-style" ng-disabled="minder.queryCommandState(\'clearstyle\') === -1"><span class="btn-icon clear-style-icon"></span> <span class="btn-label">{{ \'clearstyle\' | lang: \'ui\' }}</span></a><div class="s-btn-group-vertical"><a class="s-btn-wrap" href ng-click="minder.queryCommandState(\'copystyle\') === -1 || minder.execCommand(\'copystyle\')" ng-disabled="minder.queryCommandState(\'copystyle\') === -1"><span class="s-btn-icon copy-style-icon"></span> <span class="s-btn-label">{{ \'copystyle\' | lang: \'ui\' }}</span></a> <a class="s-btn-wrap paste-style-wrap" href ng-click="minder.queryCommandState(\'pastestyle\') === -1 || minder.execCommand(\'pastestyle\')" ng-disabled="minder.queryCommandState(\'pastestyle\') === -1"><span class="s-btn-icon paste-style-icon"></span> <span class="s-btn-label">{{ \'pastestyle\' | lang: \'ui\' }}</span></a></div></div>'),e.put("ui/directive/templateList/templateList.html",'<div class="dropdown temp-panel" dropdown on-toggle="toggled(open)"><div class="dropdown-toggle current-temp-item" ng-disabled="minder.queryCommandState(\'template\') === -1" dropdown-toggle><a href class="temp-item {{ minder.queryCommandValue(\'template\') }}" title="{{ minder.queryCommandValue(\'template\') | lang: \'template\' }}"></a> <span class="caret"></span></div><ul class="dropdown-menu temp-list"><li ng-repeat="(key, templateObj) in templateList" class="temp-item-wrap"><a ng-click="minder.execCommand(\'template\', key);" class="temp-item {{key}}" ng-class="{ \'temp-item-selected\' : key == minder.queryCommandValue(\'template\') }" title="{{ key | lang: \'template\' }}"></a></li></ul></div>'),e.put("ui/directive/themeList/themeList.html",'<div class="dropdown theme-panel" dropdown><div class="dropdown-toggle theme-item-selected" dropdown-toggle ng-disabled="minder.queryCommandState(\'theme\') === -1"><a href class="theme-item" ng-style="getThemeThumbStyle(minder.queryCommandValue(\'theme\'))" title="{{ minder.queryCommandValue(\'theme\') | lang: \'theme\'; }}">{{ minder.queryCommandValue(\'theme\') | lang: \'theme\'; }}</a> <span class="caret"></span></div><ul class="dropdown-menu theme-list"><li ng-repeat="key in themeKeyList" class="theme-item-wrap"><a ng-click="minder.execCommand(\'theme\', key);" class="theme-item" ng-style="getThemeThumbStyle(key)" title="{{ key | lang: \'theme\'; }}">{{ key | lang: \'theme\'; }}</a></li></ul></div>'),e.put("ui/directive/topTab/topTab.html",'<tabset><tab heading="{{ \'idea\' | lang: \'ui/tabs\'; }}" ng-click="toggleTopTab(\'idea\')" select="setCurTab(\'idea\')"><undo-redo editor="editor"></undo-redo><append-node minder="minder"></append-node><arrange minder="minder"></arrange><operation minder="minder"></operation><hyper-link minder="minder"></hyper-link><image-btn minder="minder"></image-btn><note-btn minder="minder"></note-btn><priority-editor minder="minder"></priority-editor><progress-editor minder="minder"></progress-editor><resource-editor minder="minder"></resource-editor></tab><tab heading="{{ \'appearence\' | lang: \'ui/tabs\'; }}" ng-click="toggleTopTab(\'appearance\')" select="setCurTab(\'appearance\')"><template-list minder="minder" class="inline-directive"></template-list><theme-list minder="minder"></theme-list><layout minder="minder" class="inline-directive"></layout><style-operator minder="minder" class="inline-directive"></style-operator><font-operator minder="minder" class="inline-directive"></font-operator></tab><tab heading="{{ \'view\' | lang: \'ui/tabs\'; }}" ng-click="toggleTopTab(\'view\')" select="setCurTab(\'view\')"><expand-level minder="minder"></expand-level><select-all minder="minder"></select-all><search-btn minder="minder"></search-btn></tab><tab heading="{{ \'file\' | lang: \'ui/tabs\'; }}" ng-click="toggleTopTab(\'file\')" select="setCurTab(\'file\')"><file-import minder="minder"></file-import><file-save minder="minder"></file-save></tab></tabset>'),e.put("ui/directive/undoRedo/undoRedo.html",'<div class="km-btn-group do-group"><div class="km-btn-item undo" ng-disabled="editor.history.hasUndo() == false" ng-click="editor.history.hasUndo() == false || editor.history.undo();" title="{{ \'undo\' | lang:\'ui\' }}"><i class="km-btn-icon"></i></div><div class="km-btn-item redo" ng-disabled="editor.history.hasRedo() == false" ng-click="editor.history.hasRedo() == false || editor.history.redo()" title="{{ \'redo\' | lang:\'ui\' }}"><i class="km-btn-icon"></i></div></div>'),e.put("ui/dialog/hyperlink/hyperlink.tpl.html",'<div class="modal-header"><h3 class="modal-title">Links</h3></div><div class="modal-body"><form><div class="form-group" id="link-url-wrap" ng-class="{true: \'has-success\', false: \'has-error\'}[urlPassed]"><label for="link-url">Link address：</label><input type="text" class="form-control" ng-model="url" ng-blur="urlPassed = R_URL.test(url)" ng-focus="this.value = url" ng-keydown="shortCut($event)" id="link-url" placeholder="必填：以 http(s):// 或 ftp:// 开头"></div><div class="form-group" ng-class="{\'has-success\' : titlePassed}"><label for="link-title">Tips：</label><input type="text" class="form-control" ng-model="title" ng-blur="titlePassed = true" id="link-title" placeholder="选填：鼠标在链接上悬停时提示的文本"></div></form></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),e.put("ui/dialog/imExportNode/imExportNode.tpl.html",'<div class="modal-header"><h3 class="modal-title">{{ title }}</h3></div><div class="modal-body"><textarea type="text" class="form-control single-input" rows="8" ng-keydown="shortCut($event);" ng-model="value" ng-readonly="type === \'export\'">\r\n    </textarea></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()" ng-disabled="type === \'import\' && value == \'\'">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),e.put("ui/dialog/image/image.tpl.html",'<div class="modal-header"><h3 class="modal-title">Images</h3></div><div class="modal-body"><tabset><tab heading="Upload images" active="true"><form><div class="form-group"><input type="file" name="upload-image" id="upload-image" class="upload-image" accept=".jpg,.JPG,jpeg,JPEG,.png,.PNG,.gif,.GIF" onchange="angular.element(this).scope().uploadImage()"><label for="upload-image" class="btn btn-primary"><span>File select&hellip;</span></label></div><div class="form-group" ng-class="{\'has-success\' : titlePassed}"><label for="image-title">Tips：</label><input type="text" class="form-control" ng-model="data.title" ng-blur="titlePassed = true" id="image-title" placeholder="Optional"></div><div class="form-group"><label for="image-preview">Image preview:</label><img class="image-preview" id="image-preview" ng-src="{{ data.url }}" title="{{ data.title }}" alt="{{ data.title }}"></div></form></tab><tab heading="Other images"><form><div class="form-group" ng-class="{true: \'has-success\', false: \'has-error\'}[urlPassed]"><label for="image-url">Links：</label><input type="text" class="form-control" ng-model="data.url" ng-blur="urlPassed = data.R_URL.test(data.url)" ng-focus="this.value = data.url" ng-keydown="shortCut($event)" id="image-url" placeholder="http(s)://"></div><div class="form-group" ng-class="{\'has-success\' : titlePassed}"><label for="image-title">Tips：</label><input type="text" class="form-control" ng-model="data.title" ng-blur="titlePassed = true" id="image-title" placeholder="Optional"></div><div class="form-group"><label for="image-preview">Image preview:</label><img class="image-preview" id="image-preview" ng-src="{{ data.url }}" alt="{{ data.title }}"></div></form></tab></tabset></div><div class="modal-footer"><button class="btn btn-primary" ng-click="ok()">OK</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>')}]),angular.module("kityminderEditor").service("commandBinder",function(){return{bind:function(e,t,n){e.on("interactchange",function(){n.commandDisabled=-1===e.queryCommandState(t),n.commandValue=e.queryCommandValue(t),n.$apply()})}}}),angular.module("kityminderEditor").provider("config",function(){this.config={ctrlPanelMin:250,ctrlPanelWidth:parseInt(window.localStorage.__dev_minder_ctrlPanelWidth)||250,dividerWidth:3,defaultLang:"zh-cn",zoom:[10,20,30,50,80,100,120,150,200],imageUpload:"server/imageUpload.php"},this.set=function(e,t){var n=Object.keys(this.config),i={};for(var r in"object"==typeof e?i=e:i[e]=t,i){if(!i.hasOwnProperty(r)||-1===n.indexOf(r))return console.error("Unsupported config key: ",e,", please choose in :",n.join(", ")),!1;this.config[r]=i[r]}return!0},this.$get=function(){var t=this;return{get:function(e){return 0===arguments.length?t.config:t.config.hasOwnProperty(e)?t.config[e]:(console.warn("Missing config key pair for : ",e),"")}}}}),angular.module("kityminderEditor").service("lang.zh-cn",function(){return{"zh-cn":{template:{default:"Mind map",tianpan:"Spiral map",structure:"Structure chart",filetree:"Content chart",right:"Tree","fish-bone":"Fish-bone figure"},theme:{classic:"Normal","classic-compact":"Compact",snow:"Snow","snow-compact":"Compact",fish:"Fish",wire:"Wire","fresh-red":"Normal","fresh-soil":"Normal","fresh-green":"Normal","fresh-blue":"Normal","fresh-purple":"Normal","fresh-pink":"Normal","fresh-red-compat":"Compact","fresh-soil-compat":"Compact","fresh-green-compat":"Compact","fresh-blue-compat":"Compact","fresh-purple-compat":"Compact","fresh-pink-compat":"Compact",tianpan:"Normal","tianpan-compact":"Compact"},maintopic:"Main topic",topic:"Topic",panels:{history:"History",template:"Template",theme:"Theme",layout:"Layout",style:"Style",font:"Font",color:"Color",background:"Background",insert:"Insert",arrange:"Arrange",nodeop:"Current",priority:"Priority",progress:"Progress",resource:"Resource",note:"Note",attachment:"Attachment",word:"Word"},error_message:{},ui:{command:{appendsiblingnode:"Sibling node",appendparentnode:"Parent node",appendchildnode:"Child node",removenode:"Remove",editnode:"Edit",arrangeup:"Up",arrangedown:"Down",resetlayout:"Reset",expandtoleaf:"Expand all",expandtolevel1:"Expand to level1",expandtolevel2:"Expand to level2",expandtolevel3:"Expand to level3",expandtolevel4:"Expand to level4",expandtolevel5:"Expand to level5",expandtolevel6:"Expand to level6",fullscreen:"Fullscreen",outline:"Outline"},search:"Search",save:"Save",import:"Import",expandtoleaf:"Expand",back:"Back",undo:"Undo (Ctrl + Z)",redo:"Redo (Ctrl + Y)",tabs:{file:"File",idea:"Idea",appearence:"Appearence",view:"View"},quickvisit:{new:"New (Ctrl + Alt + N)",save:"Save (Ctrl + S)",share:"Share (Ctrl + Alt + S)",feedback:"Feedback（F1）",editshare:"Edit"},menu:{},bold:"Bold",italic:"Italic",forecolor:"Color",fontfamily:"Font family",fontsize:"Font size",layoutstyle:"Style",node:"Node",saveto:"Save as",hand:"Drag",camera:"Position","zoom-in":"Zoom in (Ctrl+)","zoom-out":"Zoom out(Ctrl-)",markers:"Markers",resource:"Resources",help:"Help",preference:"Preference",expandnode:"Expand",collapsenode:"Collapse",template:"Template",theme:"Theme",clearstyle:"Clear",copystyle:"Copy style",pastestyle:"Paste style",appendsiblingnode:"Sibling node",appendchildnode:"Child node",arrangeup:"Up",arrangedown:"Down",editnode:"Edit",removenode:"Remove",priority:"Priority",progress:{p1:"Progress: 0",p2:"Progress: 1/8",p3:"Progress: 1/4",p4:"Progress: 3/8",p5:"Progress:",p6:"Progress: 5/8",p7:"Progress: 3/4",p8:"Progress: 7/8",p9:"Progress: 1",p0:"Clear"},link:"Links",image:"Images",note:"Notes",insertlink:"Insert link",insertimage:"Insert image",insertnote:"Insert note",removelink:"Remove link",removeimage:"Remove image",removenote:"Remove note",resetlayout:"Reset layout",selectall:"Select all",selectrevert:"Invert selection",selectsiblings:"Select sibling node",selectlevel:"Select peer node",selectpath:"Select path",selecttree:"Select subtree"},popupcolor:{clearColor:"Clear color",standardColor:"Standard color",themeColor:"Theme Color"},dialogs:{markers:{static:{lang_input_text:"Text:",lang_input_url:"Url:",lang_input_title:"Title：",lang_input_target:"Target:"},priority:"Priority",none:"None",progress:{title:"Progress",notdone:"Undone",done1:"Done 1/8",done2:"Done 1/4",done3:"Done 3/8",done4:"Done 1/2",done5:"Done 5/8",done6:"Done 3/4",done7:"Done 7/8",done:"Done"}},help:{},hyperlink:{},image:{},resource:{}},hyperlink:{hyperlink:"Link...",unhyperlink:"Remove link"},image:{image:"Image...",removeimage:"Remove image"},marker:{marker:"Progress/priority..."},resource:{resource:"Resource..."}}}}),angular.module("kityminderEditor").service("memory",function(){return{get:function(e){var t=window.localStorage.getItem(e);return JSON.parse(t)},set:function(e,t){try{return window.localStorage.setItem(e,JSON.stringify(t)),!0}catch(e){if(function(e){var t=!1;if(e)if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else-2147024882===e.number&&(t=!0);return t}(e))return!1}},remove:function(e){var t=window.localStorage.getItem(e);return window.localStorage.removeItem(e),t},clear:function(){window.localStorage.clear()}}}),angular.module("kityminderEditor").service("minder.service",function(){var t=[];return{registerEvent:function(e){t.push(e)},executeCallback:function(){t.forEach(function(e){e.apply(this,arguments)})}}}),angular.module("kityminderEditor").service("resourceService",["$document",function(t){var n=null;this.open=function(e){n||(t.bind("click",i),t.bind("keydown",r)),n&&n!==e&&(n.resourceListOpen=!1),n=e},this.close=function(e){n===e&&(n=null,t.unbind("click",i),t.unbind("keydown",r))};var i=function(e){if(n){var t=n.getToggleElement();e&&t&&t[0].contains(e.target)||n.$apply(function(){console.log("to close the resourcelist"),n.resourceListOpen=!1})}},r=function(e){27===e.which&&(n.focusToggleElement(),i())}}]),angular.module("kityminderEditor").service("revokeDialog",["$modal","minder.service",function(e,t){return t.registerEvent(function(){var t=window.minder,n=window.editor;t.on("importNodeData",function(){parentFSM.jump("modal","import-text-modal"),e.open({animation:!0,templateUrl:"ui/dialog/imExportNode/imExportNode.tpl.html",controller:"imExportNode.ctrl",size:"md",resolve:{title:function(){return"Import node"},defaultValue:function(){return""},type:function(){return"import"}}}).result.then(function(e){try{t.Text2Children(t.getSelectedNode(),e)}catch(e){alert(e)}parentFSM.jump("normal","import-text-finish"),n.receiver.selectAll()},function(){parentFSM.jump("normal","import-text-finish"),n.receiver.selectAll()})}),t.on("exportNodeData",function(){parentFSM.jump("modal","export-text-modal"),e.open({animation:!0,templateUrl:"ui/dialog/imExportNode/imExportNode.tpl.html",controller:"imExportNode.ctrl",size:"md",resolve:{title:function(){return"Export node"},defaultValue:function(){var e=t.getSelectedNode();return(0,window.kityminder.data.getRegisterProtocol("text").Node2Text)(e)},type:function(){return"export"}}}).result.then(function(e){parentFSM.jump("normal","export-text-finish"),n.receiver.selectAll()},function(){parentFSM.jump("normal","export-text-finish"),n.receiver.selectAll()})})}),{}}]),angular.module("kityminderEditor").service("server",["config","$http",function(i,r){return{uploadImage:function(e){var t=i.get("imageUpload"),n=new FormData;return n.append("upload_file",e),r.post(t,n,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})}}}]),angular.module("kityminderEditor").service("valueTransfer",function(){return{}}),angular.module("kityminderEditor").filter("commandState",function(){return function(e,t){return e.queryCommandState(t)}}).filter("commandValue",function(){return function(e,t){return e.queryCommandValue(t)}}),angular.module("kityminderEditor").filter("lang",["config","lang.zh-cn",function(r,a){return function(e,t){var n=r.get("defaultLang");if(null==a[n])return"未发现对应语言包，请检查 lang.xxx.service.js!";var i=a[n];return t.split("/").forEach(function(e,t){i=i[e]}),i[e]||null}}]),angular.module("kityminderEditor").controller("hyperlink.ctrl",["$scope","$modalInstance","link",function(t,n,e){t.R_URL=new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i"),t.url=e.url||"",t.title=e.title||"",setTimeout(function(){var e=$("#link-url");e.focus(),e[0].setSelectionRange(0,t.url.length)},30),t.shortCut=function(e){e.stopPropagation(),13==e.keyCode?t.ok():27==e.keyCode&&t.cancel()},t.ok=function(){if(t.R_URL.test(t.url))n.close({url:t.url,title:t.title});else{t.urlPassed=!1;var e=$("#link-url");e.focus(),e[0].setSelectionRange(0,t.url.length)}editor.receiver.selectAll()},t.cancel=function(){n.dismiss("cancel"),editor.receiver.selectAll()}}]),angular.module("kityminderEditor").controller("imExportNode.ctrl",["$scope","$modalInstance","title","defaultValue","type",function(r,e,t,n,a){r.title=t,r.value=n,r.type=a,r.ok=function(){""!=r.value&&(e.close(r.value),editor.receiver.selectAll())},r.cancel=function(){e.dismiss("cancel"),editor.receiver.selectAll()},setTimeout(function(){$(".single-input").focus(),$(".single-input")[0].setSelectionRange(0,n.length)},30),r.shortCut=function(e){if(e.stopPropagation(),27==e.keyCode&&r.cancel(),8==e.keyCode&&"export"==a&&e.preventDefault(),9==e.keyCode){e.preventDefault();var t=e.target,n=function(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}(t),i=t.value;t.value=i.substr(0,n)+"\t"+i.substr(n),function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}}(t,n+1)}}}]),angular.module("kityminderEditor").controller("image.ctrl",["$http","$scope","$modalInstance","image","server",function(i,r,t,e,n){r.data={list:[],url:e.url||"",title:e.title||"",R_URL:/^https?\:\/\/\w+/},setTimeout(function(){var e=$("#image-url");e.focus(),e[0].setSelectionRange(0,r.data.url.length)},300),r.searchImage=function(){var e,t,n;r.list=[],(e=r.data.searchKeyword2,t=new Date,n="http://image.baidu.com/search/acjson?tn=resultjson_com&ipn=rj&ct=201326592&fp=result&queryWord="+e+"&cl=2&lm=-1&ie=utf-8&oe=utf-8&st=-1&ic=0&word="+e+"&face=0&istype=2&nc=1&pn=60&rn=60&gsm=3c&"+t.getTime()+"=&callback=JSON_CALLBACK",i.jsonp(n)).success(function(e){if(e&&e.data)for(var t=0;t<e.data.length;t++)e.data[t].objURL&&r.list.push({title:e.data[t].fromPageTitleEnc,src:e.data[t].middleURL,url:e.data[t].middleURL})}).error(function(){})},r.selectImage=function(e){var t=$("#img-item"+this.$index),n=$("#img-"+this.$index);t.siblings(".selected").removeClass("selected"),t.addClass("selected"),r.data.url=n.attr("src"),r.data.title=n.attr("alt")},r.uploadImage=function(){var e=$("#upload-image");if(e.val()){if(/^.*\.(jpg|JPG|jpeg|JPEG|gif|GIF|png|PNG)$/.test(e.val())){var t=e[0].files[0];return n.uploadImage(t).then(function(e){var t=e.data;0===t.errno&&(r.data.url=t.data.url)})}alert("后缀只能是 jpg、gif 及 png")}},r.shortCut=function(e){e.stopPropagation(),13==e.keyCode?r.ok():27==e.keyCode&&r.cancel()},r.ok=function(){if(r.data.R_URL.test(r.data.url))t.close({url:r.data.url,title:r.data.title});else{r.urlPassed=!1;var e=$("#image-url");e&&(e.focus(),e[0].setSelectionRange(0,r.data.url.length))}editor.receiver.selectAll()},r.cancel=function(){t.dismiss("cancel"),editor.receiver.selectAll()}}]),angular.module("kityminderEditor").directive("appendNode",["commandBinder",function(t){return{restrict:"E",templateUrl:"ui/directive/appendNode/appendNode.html",scope:{minder:"="},replace:!0,link:function(e){var r=e.minder;t.bind(r,"appendchildnode",e),e.execCommand=function(e){var t,n,i;r.execCommand(e,"Branch topic"),t=editor.receiver.element,n=editor.fsm,i=editor.receiver,t.innerText=r.queryCommandValue("text"),n.jump("input","input-request"),i.selectAll()}}}}]),angular.module("kityminderEditor").directive("arrange",["commandBinder",function(e){return{restrict:"E",templateUrl:"ui/directive/arrange/arrange.html",scope:{minder:"="},replace:!0,link:function(e){e.minder}}}]),angular.module("kityminderEditor").directive("collabPanel",["Messages","RouteInfo",function(t,o){return{restrict:"E",templateUrl:"ui/directive/collabPanel/collabPanel.html",scope:{participants:"=?",drawer:"=?",collaboration:"=?",draw:"=?",leftApply:"=?"},replace:!0,link:function(r){r.participants=[],r.drawer="Nobody";var a="";r.collaboration=!1,r.draw=!1,r.leftApply=-1,r.applyCtrl=function(){if(t.isConnection()&&r.collaboration){var i=o.getInfo();if(""!=i.userName&&""!=i.userId){var e={messageType:"Authority",value:"Require",userName:i.userName,userId:i.userId};t.sendSock("collaboration",e,function(e){if(e!={})if("Authority"==e.messageType){r.drawer=JSON.parse(e.controller).userName,(a=JSON.parse(e.controller).userId)==i.userId?(document.getElementById("edit-mask").style.display="none",document.getElementById("giveup-ctrl").style.cursor="pointer"):document.getElementById("giveup-ctrl").style.cursor="not-allowed",r.participants=JSON.parse(e.userList);try{for(var t=JSON.parse(e.requireList),n=0;n<t.length;n++)t[n].userId==i.userId&&(r.leftApply=n)}catch(e){r.leftApply=-1}}else if("Left"==e.messageType){r.drawer=JSON.parse(e.controller).userName,(a=JSON.parse(e.controller).userId)==i.userId?(document.getElementById("edit-mask").style.display="none",document.getElementById("giveup-ctrl").style.cursor="pointer"):document.getElementById("giveup-ctrl").style.cursor="not-allowed",r.participants=JSON.parse(e.userList);try{for(var t=JSON.parse(e.requireList),n=0;n<t.length;n++)t[n].userId==i.userId&&(r.leftApply=n)}catch(e){r.leftApply=-1}}}),r.draw=!0}else alert("Missing user information, please log in!")}},r.giveupCtrl=function(){var i=o.getInfo();if(a==i.userId){if(t.isConnection()){document.getElementById("edit-mask").style.display="";t.sendSock("collaboration",{messageType:"Authority",value:"Release"},function(e){if(e!={})if("Authority"==e.messageType)r.drawer=JSON.parse(e.controller).userName,a=JSON.parse(e.controller).userId,r.participants=JSON.parse(e.userList);else if("Left"==e.messageType){r.drawer=JSON.parse(e.controller).userName,a=JSON.parse(e.controller).userId,r.participants=JSON.parse(e.userList);try{for(var t=JSON.parse(e.requireList),n=0;n<t.length;n++)t[n].userId==i.userId&&(r.leftApply=n)}catch(e){r.leftApply=0}}})}r.draw=!1}},r.startCollab=function(){var i=o.getInfo();if(""!=i.pageId&&""!=i.userId&&""!=i.userName){t.startWebsocket(i.pageId);var e={messageType:"Join",userId:i.userId,userName:i.userName};t.sendSock("collaboration",e,function(e){if(e!={})if("Join"==e.messageType)r.drawer=JSON.parse(e.controller).userName,a=JSON.parse(e.controller).userId,r.participants=JSON.parse(e.userList),r.collaboration=!0,document.getElementById("edit-mask").style.display="";else if("Left"==e.messageType){r.drawer=JSON.parse(e.controller).userName,a=JSON.parse(e.controller).userId,r.participants=JSON.parse(e.userList);try{for(var t=JSON.parse(e.requireList),n=0;n<t.length;n++)t[n].userId==i.userId&&(r.leftApply=n)}catch(e){r.leftApply=0}}})}else""!=i.pageId?alert("Missing page information!"):alert("Missing user information, please log in!")},r.stopCollab=function(){t.endWebsocket(),r.collaboration=!1,r.draw=!1,r.participants=[],r.drawer="Nobody",document.getElementById("edit-mask").style.display="none"},r.gotoUserspace=function(e){var t=o.getInfo(),n="";n=e==t.userId?"http://"+o.getIPPort()+"/personalPage":"http://"+o.getIPPort()+"/GeoProblemSolving/memberPage/"+e;window.location.href=n}}}}]),angular.module("kityminderEditor").directive("colorPanel",function(){return{restrict:"E",templateUrl:"ui/directive/colorPanel/colorPanel.html",scope:{minder:"="},replace:!0,link:function(n){var i=n.minder;i.getThemeItems();n.$on("colorPicked",function(e,t){e.stopPropagation(),n.bgColor=t,i.execCommand("background",t)}),n.setDefaultBg=function(){var e=i.getSelectedNode(),t=i.getNodeStyle(e,"background");return"object"==typeof t?t.toHEX():t},n.bgColor=n.setDefaultBg()||"#fff"}}}),angular.module("kityminderEditor").directive("expandLevel",function(){return{restrict:"E",templateUrl:"ui/directive/expandLevel/expandLevel.html",scope:{minder:"="},replace:!0,link:function(e){e.levels=[1,2,3,4,5,6]}}}),angular.module("kityminderEditor").directive("fileImport",["RouteInfo",function(a){return{restrict:"E",templateUrl:"ui/directive/fileImport/fileImport.html",scope:{minder:"=",mindmapRes:"=?"},replace:!0,link:function(i){function r(){var n=[],e=a.getInfo();if(""!=e.pageId){var t=e.pageId;try{$.ajax({url:"http://"+a.getIPPort()+"/GeoProblemSolving/folder/inquiry?folderId="+t,type:"GET",async:!1,success:function(e){if("Fail"==e)console.log(e);else if(null!=e.files.length){console.log("success!");for(var t=0;t<e.files.length;t++)n.push(e.files[t]);i.mindmapRes=n}},error:function(e){console.log("fail.")}})}catch(e){console.log("fail")}}else alert("Missing page information!")}i.updateMaplist=r,i.mapImport=function(){var n=document.getElementById("fileInput");if(0<n.files.length&&null!=n.files.length){var e=n.files[0],i=e.name.substr(e.name.lastIndexOf(".")+1);switch(i){case"md":i="markdown";break;case"km":case"json":i="json";break;default:return console.log("File not supported!"),void alert("Only support data format(*.km, *.md, *.json)")}var r=new FileReader;r.onload=function(e){var t=r.result;editor.minder.importData(i,t).then(function(e){$(n).val("")}),mindmapInfo={}},r.readAsText(e)}},i.mapLoad=function(n){var i=n.name.replace(/.+\./,"");switch(i){case"md":i="markdown";break;case"km":case"json":i="json";break;default:return console.log("File not supported!"),void alert("only support data format(*.km, *.md, *.json)")}try{var e="http://"+a.getIPPort()+n.pathURL,r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=function(e){if(200==r.status){var t=r.response;editor.minder.importData(i,t).then(function(e){$(fileInput).val("")}),mindmapInfo={name:n.name,resourceId:n.resourceId}}},r.send()}catch(e){mindmapInfo={},console.log("import mindmap error")}},i.deleteMap=function(e){try{var t=a.getInfo();if(""!=t.pageId){var n=t.pageId;$.ajax({url:"http://"+a.getIPPort()+"/GeoProblemSolving/folder/removeFile?fileId="+e.resourceId+"&folderId="+n,type:"GET",async:!1,success:function(e){"Fail"==e||(alert("Delete the mindmap successfully"),r())},error:function(e){alert("Fail to delete the mindmap")}})}}catch(e){console.log("fail")}}}}}]),angular.module("kityminderEditor").directive("fileSave",["RouteInfo",function(f){return{restrict:"E",templateUrl:"ui/directive/fileSave/fileSave.html",scope:{minder:"="},replace:!0,link:function(e){function g(e){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],i=atob(t[1]),r=i.length,a=new Uint8Array(r);r--;)a[r]=i.charCodeAt(r);return new Blob([a],{type:n})}e.saveMapFun=function(){if(mindmapInfo!={}&&null!=mindmapInfo.name&&null!=mindmapInfo.resourceId&&""!=mindmapInfo.name&&""!=mindmapInfo.resourceId){var e=mindmapInfo.name.substring(mindmapInfo.name.lastIndexOf(".")+1);switch(e){case"km":exportType="json";break;case"md":exportType="markdown";break;default:exportType=e}editor.minder.exportData(exportType).then(function(u){var m=f.getInfo();""!=m.pageId&&""!=m.userId?editor.minder.exportData("png").then(function(e){var s=document.createElement("canvas"),d=s.getContext("2d");s.width=120,s.height=120;var c=new Image;c.src=e,c.onload=function(){d.clearRect(0,0,120,120),d.drawImage(c,0,0,120,120);var e=s.toDataURL(),t=g(e),n=$("#mindmapName").val()+".png",i=new File([t],"thumbnail_"+n),r=new Blob([u]),a=mindmapInfo.name,o=new File([r],a),l=new FormData;l.append("resourceId",mindmapInfo.resourceId),l.append("file",o),l.append("uploaderId",m.userId),l.append("folderId",m.pageId),l.append("thumbnail",i),l.append("editToolInfo",JSON.stringify({toolName:"Mind map",toolUrl:"/GeoProblemSolving/Collaborative/Mindmap/index.html"}));try{$.ajax({url:"http://"+f.getIPPort()+"/GeoProblemSolving/folder/uploadToFolder",type:"POST",data:l,processData:!1,contentType:!1,success:function(e){"Size over"==e||"Fail"==e||"Offline"==e?console.log(e):0<e.uploaded.length&&alert("Save this mind map successfully")},error:function(e){console.log("fail.")}})}catch(e){console.log("fail")}}}):""!=m.pageId?alert("Missing page information!"):alert("Missing user information, please log in!")})}else alert('Please click "Save as".')},e.saveasMapFun=function(){if(""!=$("#mindmapName").val()&&null!=$("#mindmapName").val()){var p=$("#datatypeSelect").val();switch(p){case"km":exportType="json";break;case"md":exportType="markdown";break;default:exportType=p}editor.minder.exportData(exportType).then(function(u){var m=f.getInfo();""!=m.pageId&&""!=m.userId?editor.minder.exportData("png").then(function(e){var s=document.createElement("canvas"),d=s.getContext("2d");s.width=120,s.height=120;var c=new Image;c.src=e,c.onload=function(){d.clearRect(0,0,120,120),d.drawImage(c,0,0,120,120);var e=s.toDataURL(),t=g(e),n=$("#mindmapName").val()+".png",i=new File([t],"thumbnail_"+n),r=new Blob([u]),a=$("#mindmapName").val()+"."+p,o=new File([r],a),l=new FormData;l.append("file",o),l.append("description","Collaborative mindmap tool"),l.append("type","toolData:Mindmap"),l.append("uploaderId",m.userId),l.append("privacy","private"),l.append("folderId",m.pageId),l.append("thumbnail",i),l.append("editToolInfo",JSON.stringify({toolName:"Mind map",toolUrl:"/GeoProblemSolving/Collaborative/Mindmap/index.html"}));try{$.ajax({url:"http://"+f.getIPPort()+"/GeoProblemSolving/folder/uploadToFolder",type:"POST",data:l,processData:!1,contentType:!1,success:function(e){"Size over"==e||"Fail"==e||"Offline"==e?console.log(e):0<e.uploaded.length&&(alert("Save this mind map successfully"),mindmapInfo={name:a,resourceId:e.uploaded[0].resourceId})},error:function(e){console.log("fail."),mindmapInfo={}}})}catch(e){console.log("fail"),mindmapInfo={}}}}):""!=m.pageId?alert("Missing page information!"):alert("Missing user information, please log in!")})}},e.downloadMapFun=function(){if(mindmapInfo!={}&&null!=mindmapInfo.name&&""!=mindmapInfo.name){var d=mindmapInfo.name.substring(mindmapInfo.name.lastIndexOf(".")+1);switch(d){case"km":exportType="json";break;case"md":exportType="markdown";break;default:exportType=d}editor.minder.exportData(exportType).then(function(e){if("png"==d){for(var t=e.split(","),n=t[0].match(/:(.*?);/)[1],i=atob(t[1]),r=i.length,a=new Uint8Array(r);r--;)a[r]=i.charCodeAt(r);var o=new Blob([a],{type:n}),l=URL.createObjectURL(o)}else var o=new Blob([e]),l=URL.createObjectURL(o);var s=document.createElement("a");s.download=mindmapInfo.name,s.href=l,$("body").append(s),s.click(),$(s).remove()})}else if(""!=$("#mindmapName").val()&&null!=$("#mindmapName").val()){switch(d=$("#datatypeSelect").val()){case"km":exportType="json";break;case"md":exportType="markdown";break;default:exportType=d}editor.minder.exportData(exportType).then(function(e){if("png"==d)var t=g(e),n=URL.createObjectURL(t);else var t=new Blob([e]),n=URL.createObjectURL(t);var i=document.createElement("a");i.download=$("#mindmapName").val()+"."+d,i.href=n,$("body").append(i),i.click(),$(i).remove()})}}}}}]),angular.module("kityminderEditor").directive("fontOperator",function(){return{restrict:"E",templateUrl:"ui/directive/fontOperator/fontOperator.html",scope:{minder:"="},replace:!0,link:function(n){var i=n.minder;i.getThemeItems();n.fontSizeList=[10,12,16,18,24,32,48],n.fontFamilyList=[{name:"宋体",val:"宋体,SimSun"},{name:"微软雅黑",val:"微软雅黑,Microsoft YaHei"},{name:"楷体",val:"楷体,楷体_GB2312,SimKai"},{name:"黑体",val:"黑体, SimHei"},{name:"隶书",val:"隶书, SimLi"},{name:"Andale Mono",val:"andale mono"},{name:"Arial",val:"arial,helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"Comic Sans Ms",val:"comic sans ms"},{name:"Impact",val:"impact,chicago"},{name:"Times New Roman",val:"times new roman"},{name:"Sans-Serif",val:"sans-serif"}],n.$on("colorPicked",function(e,t){e.stopPropagation(),n.foreColor=t,i.execCommand("forecolor",t)}),n.setDefaultColor=function(){var e=i.getSelectedNode(),t=i.getNodeStyle(e,"color");return"object"==typeof t?t.toHEX():t},n.foreColor=n.setDefaultColor()||"#000",n.getFontfamilyName=function(i){var r="";return n.fontFamilyList.forEach(function(e,t,n){if(e.val===i)return r=e.name,""}),r}}}}),angular.module("kityminderEditor").directive("hyperLink",["$modal",function(n){return{restrict:"E",templateUrl:"ui/directive/hyperLink/hyperLink.html",scope:{minder:"="},replace:!0,link:function(e){var t=e.minder;e.addHyperlink=function(){var e=t.queryCommandValue("HyperLink");n.open({animation:!0,templateUrl:"ui/dialog/hyperlink/hyperlink.tpl.html",controller:"hyperlink.ctrl",size:"md",resolve:{link:function(){return e}}}).result.then(function(e){t.execCommand("HyperLink",e.url,e.title||"")})}}}}]),angular.module("kityminderEditor").directive("imageBtn",["$modal",function(n){return{restrict:"E",templateUrl:"ui/directive/imageBtn/imageBtn.html",scope:{minder:"="},replace:!0,link:function(e){var t=e.minder;e.addImage=function(){var e=t.queryCommandValue("image");n.open({animation:!0,templateUrl:"ui/dialog/image/image.tpl.html",controller:"image.ctrl",size:"md",resolve:{image:function(){return e}}}).result.then(function(e){t.execCommand("image",e.url,e.title||"")})}}}}]),angular.module("kityminderEditor").directive("kityminderEditor",["config","minder.service","revokeDialog","Messages","RouteInfo",function(l,a,e,t,s){return{restrict:"EA",templateUrl:"ui/directive/kityminderEditor/kityminderEditor.html",replace:!0,scope:{onInit:"&"},link:function(i,e,t){var r=e.children(".minder-editor")[0];function o(e,t){i.onInit({editor:e,minder:t}),a.executeCallback()}if("undefined"!=typeof seajs)seajs.config({base:"./src"}),define("demo",function(e){var t=e("editor"),a=window.editor=new t(r);window.localStorage.__dev_minder_content;var n=s.getInfo();if(""!=n.resourceId){!function(e){try{$.ajax({url:"http://"+s.getIPPort()+"/GeoProblemSolving/resource/inquiry?key=resourceId&value="+e,type:"GET",async:!1,success:function(e){"Fail"!==e&&"None"!==e&&function(n){try{var i=n.name.substr(n.name.lastIndexOf(".")+1);switch(i){case"md":i="markdown";break;case"km":case"json":i="json";break;default:return console.log("File not supported!"),alert("Only support data format(*.km, *.md, *.json)")}var e="http://"+s.getIPPort()+n.pathURL,r=new XMLHttpRequest;r.open("GET",e,!0),r.onload=function(e){if(200==r.status){var t=r.response;a.minder.importData(i,t),mindmapInfo={name:n.name,resourceId:n.resourceId}}},r.send()}catch(e){console.log(e)}}(e[0])},error:function(e){console.log("fail.")}})}catch(e){console.log("fail")}}(n.resourceId)}a.minder.on("contentchange",function(){}),setInterval(function(){window.localStorage.__dev_minder_content!==JSON.stringify(a.minder.exportJson())&&(window.localStorage.__dev_minder_content=JSON.stringify(a.minder.exportJson()))},1e3),window.minder=window.km=a.minder,i.editor=a,i.minder=minder,i.config=l.get(),i.$apply(),o(a,minder)}),seajs.use("demo");else if(window.kityminder&&window.kityminder.Editor){var n=new kityminder.Editor(r);window.editor=i.editor=n,window.minder=i.minder=n.minder,i.config=l.get(),o(n,n.minder)}}}}]),angular.module("kityminderEditor").directive("kityminderViewer",["config","minder.service",function(e,l){return{restrict:"EA",templateUrl:"ui/directive/kityminderViewer/kityminderViewer.html",replace:!0,scope:{onInit:"&"},link:function(e,t,n){var i,r,a=t.children(".minder-viewer")[0];if(window.kityminder&&window.kityminder.Editor){var o=new kityminder.Editor(a);window.editor=e.editor=o,window.minder=e.minder=o.minder,r=(i=o).minder,e.onInit({editor:i,minder:r}),l.executeCallback()}}}}]),angular.module("kityminderEditor").directive("layout",function(){return{restrict:"E",templateUrl:"ui/directive/layout/layout.html",scope:{minder:"="},replace:!0,link:function(e){}}}),angular.module("kityminderEditor").directive("navigator",["memory","config","Messages",function(g,f,e){return{restrict:"A",templateUrl:"ui/directive/navigator/navigator.html",scope:{minder:"="},link:function(n){function e(){minder.on("layout layoutallfinish",m),minder.on("viewchange",p)}function t(){minder.off("layout layoutallfinish",m),minder.off("viewchange",p)}minder.setDefaultOptions({zoom:f.get("zoom")}),n.isNavOpen=!g.get("navigator-hidden"),n.getZoomRadio=function(e){var t=minder.getOption("zoom"),n=t[0];return 1-(e-n)/(t[t.length-1]-n)},n.getHeight=function(e){var t=$(".zoom-pan").height();return n.getZoomRadio(e)*t},n.zoom=100,minder.on("zoom",function(e){n.zoom=e.zoom}),n.toggleNavOpen=function(){n.isNavOpen=!n.isNavOpen,g.set("navigator-hidden",!n.isNavOpen),n.isNavOpen?(e(),m(),p()):t()},setTimeout(function(){n.isNavOpen?(e(),m(),p()):t()},0);var i=$(".nav-previewer"),r=new kity.Paper(i[0]),a=r.put(new kity.Path),o=r.put(new kity.Path),l=r.put(new kity.Rect(100,100).stroke("red","1%")),s=new kity.Box,d=new kity.Box,c=u(minder.getTheme());function u(e){switch(e){case"tianpan":case"tianpan-compact":return function(e,t,n,i,r){var a=i>>1;e.push("M",t,n+a,"a",a,a,0,1,1,0,.01,"z")};default:return function(e,t,n,i,r){e.push("M",t,n,"h",i,"v",r,"h",-i,"z")}}}function m(){var e=minder.getRenderContainer().getBoundaryBox();s=e;r.setViewBox(e.x-30-.5,e.y-30-.5,e.width+60+1,e.height+60+1);var n=[],i=[];minder.getRoot().traverse(function(e){var t=e.getLayoutBox();c(n,t.x,t.y,t.width,t.height),e.getConnection()&&e.parent&&e.parent.isExpanded()&&i.push(e.getConnection().getPathData())}),r.setStyle("background",minder.getStyle("background")),n.length?a.fill(minder.getStyle("root-background")).setPathData(n):a.setPathData(null),i.length?o.stroke(minder.getStyle("connect-color"),"0.5%").setPathData(i):o.setPathData(null),p()}function p(){d=minder.getViewDragger().getView(),l.setBox(d.intersect(s))}minder.on("themechange",function(e){c=u(e.theme)}),function(){function t(e,t){var n=d;e.x=-e.x,e.y=-e.y;var i=minder.getPaper().getViewPortMatrix();n=i.transformBox(n);var r=e.offset(n.width/2,n.height/2);minder.getViewDragger().moveTo(r,t)}var n=!1;r.on("mousedown",function(e){n=!0,t(e.getPosition("top"),200),i.addClass("grab")}),r.on("mousemove",function(e){n&&t(e.getPosition("top"))}),$(window).on("mouseup",function(){n=!1,i.removeClass("grab")})}()}}}]),angular.module("kityminderEditor").directive("noteBtn",["valueTransfer",function(t){return{restrict:"E",templateUrl:"ui/directive/noteBtn/noteBtn.html",scope:{minder:"="},replace:!0,link:function(e){e.minder;e.addNote=function(){t.noteEditorOpen=!0}}}}]),angular.module("kityminderEditor").directive("noteEditor",["valueTransfer",function(o){return{restrict:"A",templateUrl:"ui/directive/noteEditor/noteEditor.html",scope:{minder:"="},replace:!0,controller:["$scope",function(n){var i,r=n.minder,a=!1;n.codemirrorLoaded=function(e){i=n.cmEditor=e,e.setSize("100%","100%")},n.$watch("noteContent",function(e){var t=-1!=r.queryCommandState("note");e&&t&&!a&&r.execCommand("note",e),setTimeout(function(){i.refresh()})});n.$watch(function(){return o.noteEditorOpen},function(e,t){e&&setTimeout(function(){i.refresh(),i.focus()}),n.noteEditorOpen=o.noteEditorOpen},!0),n.closeNoteEditor=function(){o.noteEditorOpen=!1,editor.receiver.selectAll()},r.on("interactchange",function(){var e=n.noteEnabled=-1!=r.queryCommandState("note"),t=r.queryCommandValue("note")||"";e&&(n.noteContent=t),a=!0,n.$apply(),a=!1})}]}}]),angular.module("kityminderEditor").directive("notePreviewer",["$sce","valueTransfer",function(v,e){return{restrict:"A",templateUrl:"ui/directive/notePreviewer/notePreviewer.html",link:function(m,e){var t,n=m.minder,p=e.parent(),g=e.children();m.showNotePreviewer=!1,marked.setOptions({gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1}),n.on("shownoterequest",function(e){t=setTimeout(function(){!function(e,t){var n=e.getRenderer("NoteIconRenderer").getRenderShape().getRenderBox("screen"),i=e.getData("note");g[0].scrollTop=0;var r=marked(i);t&&(r=r.replace(new RegExp("("+t+")","ig"),'<span class="highlight">$1</span>'));m.noteContent=v.trustAsHtml(r),m.$apply();var a=$(p[0]).width(),o=$(p[0]).height(),l=$(g).outerWidth(),s=$(g).outerHeight(),d=n.cx-l/2-p[0].offsetLeft,c=n.bottom+10-p[0].offsetTop;d<0&&(d=10);a<d+l&&(d=n.left-l-10-p[0].offsetLeft);o<c+s&&(c=n.top-s-10-p[0].offsetTop);m.previewerStyle={left:Math.round(d)+"px",top:Math.round(c)+"px"},m.showNotePreviewer=!0;var u=g[0].querySelector(".highlight");u&&u.scrollIntoView();f=!0,m.$apply()}(e.node,e.keyword)},300)}),n.on("hidenoterequest",function(){clearTimeout(t),m.showNotePreviewer=!1});var f=!1;$(document).on("mousedown mousewheel DOMMouseScroll",function(){f&&(m.showNotePreviewer=!1,m.$apply())}),e.on("mousedown mousewheel DOMMouseScroll",function(e){e.stopPropagation()})}}}]),angular.module("kityminderEditor").directive("operation",function(){return{restrict:"E",templateUrl:"ui/directive/operation/operation.html",scope:{minder:"="},replace:!0,link:function(e){e.editNode=function(){var e=editor.receiver.element,t=editor.fsm,n=editor.receiver;e.innerText=minder.queryCommandValue("text"),t.jump("input","input-request"),n.selectAll()}}}}),angular.module("kityminderEditor").directive("priorityEditor",["commandBinder",function(r){return{restrict:"E",templateUrl:"ui/directive/priorityEditor/priorityEditor.html",scope:{minder:"="},replace:!0,link:function(e){for(var t=e.minder,n=[],i=0;i<10;i++)n.push(i);r.bind(t,"priority",e),e.priorities=n,e.getPriorityTitle=function(e){switch(e){case 0:return"Remove priority";default:return"Priority"+e}}}}}]),angular.module("kityminderEditor").directive("progressEditor",["commandBinder",function(r){return{restrict:"E",templateUrl:"ui/directive/progressEditor/progressEditor.html",scope:{minder:"="},replace:!0,link:function(e){for(var t=e.minder,n=[],i=0;i<10;i++)n.push(i);r.bind(t,"progress",e),e.progresses=n,e.getProgressTitle=function(e){switch(e){case 0:return"Remove progress";case 1:return"Undone";case 9:return"Done";default:return"Done"+(e-1)+"/8"}}}}}]),angular.module("kityminderEditor").directive("resourceEditor",function(){return{restrict:"E",templateUrl:"ui/directive/resourceEditor/resourceEditor.html",scope:{minder:"="},replace:!0,controller:["$scope",function(n){var i=n.minder,r=!1;i.on("interactchange",function(){var t=(n.enabled=-1!=i.queryCommandState("resource"))?i.queryCommandValue("resource"):[],e=i.getUsedResource().map(function(e){return{name:e,selected:-1<t.indexOf(e)}});n.used=e,r=!0,n.$apply(),r=!1}),n.$watch("used",function(e){if(-1!=i.queryCommandState("resource")&&e){var t=e.filter(function(e){return e.selected}).map(function(e){return e.name});if(r)return;i.execCommand("resource",t)}},!0),n.resourceColor=function(e){return i.getResourceColor(e).toHEX()},n.addResource=function(e){var t=i.queryCommandValue("resource");e&&/\S/.test(e)&&(-1==t.indexOf(e)&&n.used.push({name:e,selected:!0}),n.newResourceName=null)}}]}}).directive("clickAnywhereButHere",["$document",function(a){return{link:function(i,e,r){var n=function(e){var t=0<$("#resource-dropdown").has(e.target).length,n=$("#resource-dropdown")==e.target;t||n||i.$apply(r.clickAnywhereButHere)};i.$watch(r.isActive,function(e,t){e!==t&&1==e?a.bind("click",n):e!==t&&0==e&&a.unbind("click",n)})}}}]),angular.module("kityminderEditor").directive("searchBox",function(){return{restrict:"A",templateUrl:"ui/directive/searchBox/searchBox.html",scope:{minder:"="},replace:!0,controller:["$scope",function(o){var l=o.minder,e=window.editor;function n(){$("#search-input").blur(),o.showSearch=!1,l.fire("hidenoterequest"),e.receiver.selectAll()}function t(){o.showSearch=!0,setTimeout(function(){$("#search-input").focus()},10),o.keyword&&$("#search-input")[0].setSelectionRange(0,o.keyword.length)}o.handleKeyDown=function(e){if(13==e.keyCode){var t=e.shiftKey?"prev":"next";c(o.keyword,t)}27==e.keyCode&&n()},o.doSearch=c,o.exitSearch=n,o.showTip=!1,o.showSearch=!1,$("body").on("keydown",function(e){70!=e.keyCode||!e.ctrlKey&&!e.metaKey||e.shiftKey||(t(),o.$apply(),e.preventDefault())}),l.on("searchNode",function(){t()});var s=[],d=[];function i(){s=[],l.getRoot().traverse(function(e){s.push(e)})}function c(e,t){if(o.showTip=!1,l.fire("hidenoterequest"),e&&/\S/.exec(e)){o.showTip=!0,o.curIndex=0,o.resultNum=0,e=e.toLowerCase();var n,i,r=c.lastKeyword!=e;if(c.lastKeyword=e,r&&function(e){d=[];for(var t=0;t<s.length;t++){var n=s[t];-1!=n.getText().toLowerCase().indexOf(e)&&d.push({node:n});var i=n.getData("note");i&&-1!=i.toLowerCase().indexOf(e)&&d.push({node:n,keyword:e})}}(e),o.resultNum=d.length,d.length){var a=r?0:("next"===t?c.lastIndex+1:c.lastIndex-1)||0;a=(d.length+a)%d.length,n=d[a].node,i=d[a].keyword,l.execCommand("camera",n,50),setTimeout(function(){l.select(n,!0),n.isExpanded()||l.execCommand("expand",!0),i&&l.fire("shownoterequest",{node:n,keyword:i})},60),c.lastIndex=a,o.curIndex=a+1}}else $("#search-input").focus()}l.on("contentchange",i),i()}]}}),angular.module("kityminderEditor").directive("searchBtn",function(){return{restrict:"E",templateUrl:"ui/directive/searchBtn/searchBtn.html",scope:{minder:"="},replace:!0,link:function(e){e.enterSearch=function(){minder.fire("searchNode")}}}}),angular.module("kityminderEditor").directive("selectAll",function(){return{restrict:"E",templateUrl:"ui/directive/selectAll/selectAll.html",scope:{minder:"="},replace:!0,link:function(e){var i=e.minder;e.items=["revert","siblings","level","path","tree"],e.select={all:function(){var t=[];i.getRoot().traverse(function(e){t.push(e)}),i.select(t,!0),i.fire("receiverfocus")},revert:function(){var t=i.getSelectedNodes(),n=[];i.getRoot().traverse(function(e){-1==t.indexOf(e)&&n.push(e)}),i.select(n,!0),i.fire("receiverfocus")},siblings:function(){var e=i.getSelectedNodes(),t=[];e.forEach(function(e){e.parent&&e.parent.children.forEach(function(e){-1==t.indexOf(e)&&t.push(e)})}),i.select(t,!0),i.fire("receiverfocus")},level:function(){var t=i.getSelectedNodes().map(function(e){return e.getLevel()}),n=[];i.getRoot().traverse(function(e){-1!=t.indexOf(e.getLevel())&&n.push(e)}),i.select(n,!0),i.fire("receiverfocus")},path:function(){var e=i.getSelectedNodes(),t=[];e.forEach(function(e){for(;e&&-1==t.indexOf(e);)t.push(e),e=e.parent}),i.select(t,!0),i.fire("receiverfocus")},tree:function(){var e=i.getSelectedNodes(),t=[];e.forEach(function(e){e.traverse(function(e){-1==t.indexOf(e)&&t.push(e)})}),i.select(t,!0),i.fire("receiverfocus")}}}}}),angular.module("kityminderEditor").directive("styleOperator",function(){return{restrict:"E",templateUrl:"ui/directive/styleOperator/styleOperator.html",scope:{minder:"="},replace:!0}}),angular.module("kityminderEditor").directive("templateList",function(){return{restrict:"E",templateUrl:"ui/directive/templateList/templateList.html",scope:{minder:"="},replace:!0,link:function(e){e.templateList=kityminder.Minder.getTemplateList()}}}),angular.module("kityminderEditor").directive("themeList",function(){return{restrict:"E",templateUrl:"ui/directive/themeList/themeList.html",replace:!0,link:function(e){var i=kityminder.Minder.getThemeList();e.getThemeThumbStyle=function(e){var t=i[e];if(t){var n={color:t["root-color"],"border-radius":t["root-radius"]/2};return t["root-background"]&&(n.background=t["root-background"].toString()),n}},e.themeKeyList=["classic","classic-compact","fresh-blue","fresh-blue-compat","fresh-green","fresh-green-compat","fresh-pink","fresh-pink-compat","fresh-purple","fresh-purple-compat","fresh-red","fresh-red-compat","fresh-soil","fresh-soil-compat","snow","snow-compact","tianpan","tianpan-compact","fish","wire"]}}}),angular.module("kityminderEditor").directive("topTab",function(){return{restrict:"A",templateUrl:"ui/directive/topTab/topTab.html",scope:{minder:"=topTab",editor:"="},link:function(e){var r=!1,a=!0,o=!0;e.setCurTab=function(e){setTimeout(function(){r=!0,"idea"!=e&&(a=!1)})},e.toggleTopTab=function(){setTimeout(function(){var e,t,n,i;r&&!a||(a=!1,o?(n=$(".tab-content"),i=$(".minder-editor"),n.animate({height:0,display:"none"}),i.animate({top:"32px"})):(e=$(".tab-content"),t=$(".minder-editor"),e.animate({height:"60px",display:"block"}),t.animate({top:"92px"})),o=!o),r=!1})}}}}),angular.module("kityminderEditor").directive("undoRedo",function(){return{restrict:"E",templateUrl:"ui/directive/undoRedo/undoRedo.html",scope:{editor:"="},replace:!0,link:function(e){}}}),e="expose-editor",c.r([t[e]])}();